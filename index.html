<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSandbox.js</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            background: #f5f5f5;
        }
        header, main, footer {
            padding: 0 10px;
            max-width: 700px;
            margin: auto;
            text-align: center;
        }
        footer {
            padding-bottom: 20px;
            text-align: left;
        }
        .logo {
            margin-top: 30px;
            font-size: 8em;
        }
        h1 {
            position: relative;
            margin: 20px 0 0 0;
            font-size: 2.2em;
            letter-spacing: 5px;
            color: #003cb1;
        }
        h1 sup {
            position: absolute;
            bottom: 20px;
            font-size: 14px;
            font-weight: 500;
            color: #f44336;
            letter-spacing: 1px;
        }
        h1, h2 {
            font-family: 'Source Sans Pro', 'Helvetica Neue', Arial, sans-serif;
            font-weight: 300;
        }
        h2 {
            margin: 5px 0 80px 0;
            line-height: 1.2em;
            font-size: 1em;
            color: #666;
        }
        .examples, .examples button {
            color: #666;
        }
        .buttons {
            padding: 20px 0;
        }
        .main-button {
            padding: 0.75em 2em;
            border-radius: 2em;
            display: inline-block;
            transition: all 0.15s ease;
            box-sizing: border-box;
            margin: 1em 0;
            font-size: 1em;
            font-weight: normal;
            letter-spacing: 0.1em;
            border: 1px solid #003cb1;
            text-decoration: none;
            cursor: pointer;
            font-family: 'Source Sans Pro', 'Helvetica Neue', Arial, sans-serif;
            background-color: #003cb1;
            color: #FFF;
            outline: none;
        }

        .main-button:focus {
            border: 1px solid #FFF;
        }

        web-sandbox {
            text-align: left;
            width: 100%;
            min-height: 306px;
            border: 3px dashed #acacac;
            border-radius: 10px;
        }
        web-sandbox:not(:defined) {
            display: none;
        }

        web-sandbox:defined {
            display: inline-block;
        }

        [id=source-text] {
            width: 100%;
            min-width: 100%;
            max-width: 100%;
            padding: 10px;
            height: 15em;
            background-color: rgba(255, 255, 255, .5);
            border-radius: 10px;
        }

        [id=source-text]:focus {
            background-color: #FFF;
        }
        footer small {
            color: #acacac;
            font-weight: normal;
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">☂️ </div>
        <h1>WebSandbox.js<sup>Beta</sup></h1>
        <h2>JavaScript's DOM Sandbox</h2>
    </header>

    <main>
        <div class="code">
            <textarea autofocus="autofocus" placeholder="Enter your javascript" autocomplete="off" spellcheck="false" id="source-text" rows="20" cols="80"></textarea>
        </div>
        <div class="examples">
            Examples:
            <button onclick="innerExamples('basic')">Basic</button>
            <button onclick="innerExamples('websandbox-environment')">DOM API</button>
            <button onclick="innerExamples('canvas')">Canvas</button>
            <button onclick="innerExamples('systemjs')">Systemjs</button>
            <button onclick="innerExamples('vue-todomvc')">Vue.js Todo MVC</button>
            <button onclick="innerExamples('child-websandbox')">Child WebSandbox</button>
            <button onclick="innerExamples('sandbox-attr')">Sandbox Config</button>
            <button onclick="innerExamples('sandbox-security-error')">XSS</button>
        </div>
        <div class="buttons"><button class="main-button" id="run">Render To WebSandbox</button></div>
        <div class="sandbox-view">
            <web-sandbox name="sandbox-evaluate" title="WebSandbox View"></web-sandbox>
        </div>
    </main>

    <footer>
        <small>
            Note: you can look in the console to inspect the original output of the evaluation.
        </small>
    </footer>

    <script src="/dist/web-sandbox.umd.js"></script>
    <script>
        const sourceElement = document.getElementById('source-text');
        const sandbox = document.querySelector('web-sandbox[name=sandbox-evaluate]');

        customElements.whenDefined('web-sandbox').then(() => {
            const LOCAL_STORGE_KEY = 'examples';
            sourceElement.value = localStorage.getItem(LOCAL_STORGE_KEY) || '';
            document.getElementById('run').onclick = () => {
                const source = sourceElement.value;
                let result, output;

                console.time('evaluate');
                result = sandbox.evaluate(source);
                console.timeEnd('evaluate');
                localStorage.setItem(LOCAL_STORGE_KEY, source);
            };
        });

        window.sandbox = sandbox;
        window.innerExamples = (id) => {
            const url = `/examples/${id}/index.js`;
            fetch(url).then(res => {
                if (!res.ok) {
                    throw Error([res.status, res.statusText, url].join(', '));
                }
                const jsContentTypeRegEx = /^(text|application)\/(x-)?javascript(;|$)/;
                const contentType = res.headers.get('content-type');

                if (!contentType || !jsContentTypeRegEx.test(contentType)) {
                    throw Error(contentType);
                }

                return res.text().then(source => {
                    if (source.indexOf('//# sourceURL=') < 0) {
                        source += `\n//# sourceURL=${url}`;
                    }
                    sourceElement.value = source;
                });

            });
        };
    </script>

</body>

</html>