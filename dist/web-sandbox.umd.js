(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self,e.WebSandbox=t())})(this,function(){'use strict';var j=String.prototype;function e(e,t=void 0){const n=`please report internal shim error: ${e}`;console.error(n),t&&(console.error(`${t}`),console.error(`${t.stack}`));debugger;throw n}function t(t,n){t||e(n)}function n(e){let t=`'use strict'; (${e})`;return t=t.replace(/\(0,\s*_[0-9a-fA-F]{3}\u200D\.e\)/g,"(0, eval)"),t=t.replace(/_[0-9a-fA-F]{3}\u200D\.g\./g,""),t=t.replace(/cov_[^+]+\+\+[;,]/g,""),t}function a(e,t){const{callAndWrapError:n}=e,{initRootRealm:a,initCompartment:o,getRealmGlobal:r,realmEvaluate:i}=t,{create:l,defineProperties:s}=Object;class c{constructor(){throw new TypeError("Realm is not a constructor")}static makeRootRealm(t={}){const o=l(c.prototype);return n(a,[e,o,t]),o}static makeCompartment(t={}){const a=l(c.prototype);return n(o,[e,a,t]),a}get global(){return n(r,[this])}evaluate(e,t,a={}){return n(i,[this,e,t,a])}}return s(c,{toString:{value:()=>"function Realm() { [shim code] }",writable:!1,enumerable:!1,configurable:!0}}),s(c.prototype,{toString:{value:()=>"[object Realm]",writable:!1,enumerable:!1,configurable:!0}}),c}function o(e,n=!1){function a(n,a,r,i){for(const l of n){const n=V(e,l);n&&(t("value"in n,`unexpected accessor on global property: ${l}`),o[l]={value:n.value,writable:a,enumerable:r,configurable:i})}}const o={};return n?(a(Z,!0,!1,!0),a($,!0,!1,!0)):(a(Z,!1,!1,!1),a($,!1,!1,!1)),a(ee,!0,!1,!0),o}function r(){function e(e){if(void 0===e||null===e)throw new TypeError(`can't convert undefined or null to object`);return Object(e)}function t(e){return"symbol"==typeof e?e:`${e}`}function n(e,t){if("function"!=typeof e)throw TypeError(`invalid ${t} usage`);return e}const{defineProperty:a,defineProperties:o,getOwnPropertyDescriptor:r,getPrototypeOf:i,prototype:l}=Object;try{(0,l.__lookupGetter__)("x")}catch(e){return}o(l,{__defineGetter__:{value:function(t,o){const r=e(this);a(r,t,{get:n(o,"getter"),enumerable:!0,configurable:!0})}},__defineSetter__:{value:function(t,o){const r=e(this);a(r,t,{set:n(o,"setter"),enumerable:!0,configurable:!0})}},__lookupGetter__:{value:function(n){let a=e(this);n=t(n);let o;for(;a&&!(o=r(a,n));)a=i(a);return o&&o.get}},__lookupSetter__:{value:function(n){let a=e(this);n=t(n);let o;for(;a&&!(o=r(a,n));)a=i(a);return o&&o.set}}})}function i(){function e(e,o){let r;try{r=(0,eval)(o)}catch(t){if(t instanceof SyntaxError)return;throw t}const i=n(r),l=function(){throw new TypeError("Not available")};t(l,{name:{value:e}}),t(i,{constructor:{value:l}}),t(l,{prototype:{value:i}}),l!==Function.prototype.constructor&&a(l,Function.prototype.constructor)}const{defineProperties:t,getPrototypeOf:n,setPrototypeOf:a}=Object;e("Function","(function(){})"),e("GeneratorFunction","(function*(){})"),e("AsyncFunction","(async function(){})"),e("AsyncGeneratorFunction","(async function*(){})")}function l(){const e=new Function("try {return this===global}catch(e){return false}")();if(!e)return;const t=require("vm"),n=t.runInNewContext(ne);return n}function s(){if("undefined"!=typeof document){const e=document.createElement("iframe");e.style.display="none",document.body.appendChild(e);const t=e.contentWindow.eval(te);return t}}function c(e,t=[],n=!1){const a=o(e,n),r=e.eval,i=e.Function,l=r(k)();return D({unsafeGlobal:e,sharedGlobalDescs:a,unsafeEval:r,unsafeFunction:i,callAndWrapError:l,allShims:t})}function d(e,t=!1){const n=ae(),a=c(n,e,t),{unsafeEval:o}=a;return o(oe)(),o(re)(),a}function u(e,t={}){const n=F(e),a=B(n,n=>{if(n in t)return!1;if("eval"===n||le.has(n)||!J(ie,n))return!1;const a=V(e,n);return!1===a.configurable&&!1===a.writable&&K(a,"value")});return a}function m(e){const t=e.search(me);if(-1!==t){const n=e.slice(0,t).split("\n").length;throw new SyntaxError(`possible html comment syntax rejected around line ${n}`)}}function p(e){const t=e.search(pe);if(-1!==t){const n=e.slice(0,t).split("\n").length;throw new SyntaxError(`possible import expression rejected around line ${n}`)}}function b(e){const t=e.search(be);if(-1!==t){const n=e.slice(0,t).split("\n").length;throw new SyntaxError(`possible direct eval expression rejected around line ${n}`)}}function f(e){m(e),p(e),b(e)}function g(e){return 0===e.length?"":`const {${X(e,",")}} = this;`}function y(e,t){const{unsafeFunction:n}=e,a=g(t);return n(`with (arguments[0]) {${a};return function() {'use strict';return eval(arguments[0]);};}`)}function h(t,n,a,o){const{unsafeEval:r}=t,i=r(ue);return function(l={},s={}){const c=s.transforms||[],d=Y(c,a||[],[fe]);return function(a){let s={src:a,endowments:l};s=i(s,d);const c=u(n,s.endowments),m=u(s.endowments),p=Y(c,m),b=y(t,p),f=r(se)(t,n,s.endowments,o),g=Proxy.revocable({},f),h=g.proxy,v=U(b,n,[h]);f.useUnsafeEvaluator=!0;let E;try{return U(v,n,[s.src])}catch(t){throw E=t,t}finally{f.useUnsafeEvaluator&&(g.revoke(),e("handler did not revoke useUnsafeEvaluator",E))}}}}function v(e,n){const{unsafeEval:a,unsafeFunction:o}=e,r=a(ce)(e,n);return t(H(r).constructor!==Function,"hide Function"),t(H(r).constructor!==o,"hide unsafeFunction"),r}function E(e){return(t,n,a={})=>e(n,a)(t)}function S(e,n){const{unsafeGlobal:a,unsafeEval:o,unsafeFunction:r}=e,i=o(de)(e,function(...e){const t=`${q(e)||""}`;let o=`${X(e,",")}`;if(!J(/^[\w\s,]*$/,o))throw new SyntaxError("shim limitation: Function arg must be simple ASCII identifiers, possibly separated by commas: no default values, pattern matches, or non-ASCII parameter names");if(new r(t),Q(o,")"))throw new a.SyntaxError("shim limitation: Function arg string contains parenthesis");0<o.length&&(o+="\n/*``*/");const i=`(function(${o}){\n${t}\n})`;return n(i)});return t(H(i).constructor!==Function,"hide Function"),t(H(i).constructor!==r,"hide unsafeFunction"),i}function N(e){return t(Object(e)===e,"bad object, not a Realm instance"),t(ge.has(e),"Realm instance has no record"),ge.get(e)}function O(e,n){t(Object(e)===e,"bad object, not a Realm instance"),t(!ge.has(e),"Realm instance already has a record"),ge.set(e,n)}function C(e,t,n){I(e,{eval:{value:t,writable:!0,configurable:!0},Function:{value:n,writable:!0,configurable:!0}})}function w(e,t,n){const{sharedGlobalDescs:a,unsafeGlobal:o}=e,r=M(o.Object.prototype,a),i=h(e,r,t,n),l=i(),s=v(e,l),c=S(e,l),d=E(i);C(r,s,c);const u=D({safeGlobal:r,safeEval:s,safeEvalWhichTakesEndowments:d,safeFunction:c});return u}function T(e){return"object"==typeof e&&null!==e}function A(e){return"function"==typeof e}function x(e,t){return new Proxy(e,{get(e,n,a){const o=Reflect.has(e,n)?[e,n,a]:[t,n];return Reflect.get(...o)},has(e,n){return Reflect.has(e,n)||Reflect.has(t,n)},ownKeys(e){return new Set(...Reflect.ownKeys(e),...Reflect.ownKeys(t))},set(e,n,a,o){const r=Reflect.has(e,n)?[e,n,a,o]:[t,n,a];return Reflect.set(...r)},deleteProperty(e,n){return Reflect.deleteProperty(Reflect.has(e,n)?e:t,n)},getOwnPropertyDescriptor(e,n){return Reflect.getOwnPropertyDescriptor(Reflect.has(e,n)?e:t,n)}})}function R(){return window.document.createElement("web-sandbox")}const L=n(a),k=n(function(){const{getPrototypeOf:e}=Object,{apply:t}=Reflect,n=e=>(n,...a)=>t(e,n,a),a=n(Map.prototype.get),o=n(Set.prototype.has),r=new Map([["EvalError",EvalError],["RangeError",RangeError],["ReferenceError",ReferenceError],["SyntaxError",SyntaxError],["TypeError",TypeError],["URIError",URIError]]),i=new Set([EvalError.prototype,RangeError.prototype,ReferenceError.prototype,SyntaxError.prototype,TypeError.prototype,URIError.prototype,Error.prototype]);return function(n,l){try{return t(n,void 0,l)}catch(t){if(Object(t)!==t)throw t;if(o(i,e(t)))throw t;let n,l,s;try{n=`${t.name}`,l=`${t.message}`,s=`${t.stack||l}`}catch(e){throw new Error("unknown error")}const c=a(r,n)||Error;try{throw new c(l)}catch(e){throw e.stack=s,e}}}}),{assign:P,create:M,freeze:D,defineProperties:I,getOwnPropertyDescriptor:V,getOwnPropertyDescriptors:_,getOwnPropertyNames:F,getPrototypeOf:H,setPrototypeOf:W}=Object,{apply:U,ownKeys:z}=Reflect,G=e=>(t,...n)=>U(e,t,n),K=G(Object.prototype.hasOwnProperty),B=G(Array.prototype.filter),q=G(Array.prototype.pop),X=G(Array.prototype.join),Y=G(Array.prototype.concat),J=G(RegExp.prototype.test),Q=G(j.includes),Z=["Infinity","NaN","undefined"],$=["isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","Array","ArrayBuffer","Boolean","DataView","EvalError","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Map","Number","Object","RangeError","ReferenceError","Set","String","Symbol","SyntaxError","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","URIError","WeakMap","WeakSet","JSON","Math","Reflect","escape","unescape"],ee=["Date","Error","Promise","Proxy","RegExp","Intl"],te="'use strict'; this",ne=`(0, eval)("'use strict'; this")`,ae=()=>{const e=s(),t=l();if(!e&&!t||e&&t)throw new Error("unexpected platform, unable to create Realm");return e||t},oe=n(r),re=n(i),ie=/^[a-zA-Z_$][\w$]*$/,le=new Set(["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","new","return","super","switch","this","throw","try","typeof","var","void","while","with","yield","let","static","enum","implements","package","protected","interface","private","public","await","null","true","false","this","arguments"]),se=n(function(e,t,n={},a=!1){const{unsafeGlobal:o,unsafeEval:r}=e,{freeze:i,getOwnPropertyDescriptor:l}=Object,{get:s,set:c}=Reflect,d=new Proxy(i({}),{get(e,t){throw new TypeError(`unexpected scope handler trap called: ${t+""}`)}});return{__proto__:d,useUnsafeEvaluator:!1,get(e,a){return"symbol"==typeof a?void 0:"eval"===a&&!0===this.useUnsafeEvaluator?(this.useUnsafeEvaluator=!1,r):a in n?s(n,a,t):s(t,a)},set(e,a,o){if(a in n){const e=l(n,a);return"value"in e?c(n,a,o):c(n,a,o,t)}return c(t,a,o)},has(e,r){return!!a||!!("eval"===r||r in n||r in t||r in o)},getPrototypeOf(){return null}}}),ce=n(function(e,t){const{callAndWrapError:n}=e,{defineProperties:a}=Object,o={eval(){return n(t,arguments)}}.eval;return a(o,{toString:{value:()=>`function ${"eval"}() { [shim code] }`,writable:!1,enumerable:!1,configurable:!0}}),o}),de=n(function(e,t){const{callAndWrapError:n,unsafeFunction:a}=e,{defineProperties:o}=Object,r=function(){return n(t,arguments)};return o(r,{prototype:{value:a.prototype},toString:{value:()=>"function Function() { [shim code] }",writable:!1,enumerable:!1,configurable:!0}}),r}),ue=n(function(e,t){const{create:n,getOwnPropertyDescriptors:a}=Object,{apply:o}=Reflect,r=(e=>(t,...n)=>o(e,t,n))(Array.prototype.reduce);return e={src:`${e.src}`,endowments:n(null,a(e.endowments))},e=r(t,(e,t)=>t.rewrite?t.rewrite(e):e,e),e={src:`${e.src}`,endowments:n(null,a(e.endowments))},e}),me=/(?:<!--|-->)/,pe=/\bimport\s*(?:\(|\/[/*])/,be=/\beval\s*(?:\(|\/[/*])/,fe={rewrite(e){return f(e.src),e}},ge=new WeakMap,ye={initRootRealm:function(e,t,n){const{shims:a,transforms:o,sloppyGlobals:r,configurableGlobals:i}=n,l=Y(e.allShims,a),s=d(l,i),{unsafeEval:c}=s,u=c(L)(s,ye);s.sharedGlobalDescs.Realm={value:u,writable:!0,configurable:!0};const m=w(s,o,r),{safeEvalWhichTakesEndowments:p}=m;for(const a of l)p(a);O(t,m)},initCompartment:function(e,t,n={}){const{transforms:a,sloppyGlobals:o}=n,r=w(e,a,o);O(t,r)},getRealmGlobal:function(e){const{safeGlobal:t}=N(e);return t},realmEvaluate:function(e,t,n={},a={}){const{safeEvalWhichTakesEndowments:o}=N(e);return o(t,n,a)}},he=function(){const e=eval,t=e(te);return r(),i(),c(t)}(),ve=a(he,ye);var Ee=({name:e,compartment:t,top:n,parent:a,view:o,allow:r,debug:i},l)=>{const s={};s.name=e,s.compartment=t,s.global=t.global,s.top=n,s.parent=a,s.debug=i,s.view=o,s.allow=r,s.sandboxAttribute="web-sandbox.",s.sandboxScriptType=`text/${s.sandboxAttribute}script`,s.sandboxElementDefined=`${s.sandboxAttribute}defined`,s.Symbol={constructor:Symbol("constructor"),proxy:Symbol("proxy"),static:Symbol("static"),createdCallback:Symbol("createdCallback"),connectedCallback:Symbol("connectedCallback"),disconnectedCallback:Symbol("disconnectedCallback"),adoptedCallback:Symbol("adoptedCallback"),attributeChangedCallback:Symbol("attributeChangedCallback")},s.WebSandboxSecurityError=class extends TypeError{constructor(){super(...arguments),this.name="WebSandboxSecurityError"}},s.toNativeObject=function(e){const t=s.toNativeObject.cache.get(e);return t?t:e},s.toNativeObject.cache=new WeakMap,s.toVirtualObject=function(e,t){if(s.toVirtualObject.cache.has(e))return s.toVirtualObject.cache.get(e);if(!t)if(e instanceof s.parent.HTMLElement){const n=s.elementRegistry.get(e.localName);t=n?n.constructor:s.classRegistry.get(e.tagName.includes("-")?"HTMLElement":"HTMLUnknownElement")}else t=s.classRegistry.get(e.constructor.name);if(!t||[s.parent,s.parent.document].includes(e)||e.isConnected&&e instanceof s.parent.Node&&s.parent.document.documentElement.contains(e))throw new s.WebSandboxSecurityError(`Forbidden: ${e.toString()}`);let n=Object.create(t.prototype);const a=n[s.Symbol.createdCallback],o=n[s.Symbol.proxy];return o&&(n=l.inherits(n,new Proxy(e,o))),s.toNativeObject.cache.set(n,e),s.toVirtualObject.cache.set(e,n),a&&a.call(n),n},s.toVirtualObject.cache=new WeakMap,s.toNativeFunction=function(e){if(s.toNativeFunction.cache.has(e))return s.toNativeFunction.cache.get(e);const t=e=>e.map(e=>s.toVirtualAny(e)),n=function(...n){const a=this,o=a?s.toVirtualObject(a):void 0,r=t(n),i=Reflect.apply(e,o,r);return s.toNativeAny(i)};return Reflect.defineProperty(n,"name",{value:e.name,configurable:!0}),s.toNativeFunction.cache.set(e,n),n},s.toNativeFunction.cache=new WeakMap,s.toVirtualFunction=function(e){if(s.toVirtualFunction.cache.has(e))return s.toVirtualFunction.cache.get(e);const t=e=>e.map(e=>s.toNativeAny(e)),n=function(...n){const a=this,o=a?s.toNativeObject(a):void 0,r=t(n),i=Reflect.apply(e,o,r);return s.toVirtualAny(i)};return Reflect.defineProperty(n,"name",{value:e.name,configurable:!0}),s.toVirtualFunction.cache.set(e,n),n},s.toVirtualFunction.cache=new WeakMap,s.toVirtualAny=function(e){return l.isObject(e)?s.toVirtualObject(e):l.isFunction(e)?s.toVirtualFunction(e):e},s.toNativeAny=function(e){return l.isObject(e)?s.toNativeObject(e):l.isFunction(e)?s.toNativeFunction(e):e};class c extends Map{define(e,t,n={}){return this.set(e,{name:e,constructor:t,observedAttributes:t.observedAttributes||[],options:n}),t}}s.elementRegistry=new c;class d extends Map{define(e,t){return this.set(e,t),t}}return s.classRegistry=new d,s},Se=(e,t)=>{e.console=Object.entries(e.parent.console).reduce((t,[n,a])=>(t[n]=e.debug?a:function(){a(...arguments)},t),{}),e.sanitizer=new t.Sanitizer({uponSanitizeElement(n,a){"script"===a.tagName&&t.isJavaScriptType(n.type)&&n.setAttribute("type",e.sandboxScriptType)}});const n=(t,n,a,o)=>{const r=o||function(){const t=[...arguments].map(t=>e.toNativeAny(t)),a=Reflect.construct(n,t),o=e.toVirtualObject(a,Reflect.getPrototypeOf(this).constructor);return o};return r.prototype=Object.create(a.prototype,{[Symbol.toStringTag]:{value:t,enumerable:!1,writable:!1,configurable:!0},constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Reflect.defineProperty(r,"name",{value:t,writable:!1,enumerable:!1,configurable:!0}),Reflect.setPrototypeOf(r,a),r};e.classGenerator=function(a,o){const r={Document:e.parent.ShadowRoot,Window:e.parent.Node},i=r[a]||e.parent[a];if(!i)return e.console.warn(`parent['${a}'] is not defined`),!1;const l=Reflect.getPrototypeOf(i);let s;s=""===l.name?Object:e.classRegistry.get(l.name),s||(s=Object,e.debug&&e.console.warn(`class ${a} extends ${l.name}: ${l.name} is not defined`));let c=t.isObject(o)?o:e.debug?o(e,t):e.compartment.evaluate(o.toString())(e,t);if(!0===c){const t=["constructor"],n=["arguments","caller","length","name","prototype"];c={...Reflect.ownKeys(i.prototype).filter(e=>!t.includes(e)).reduce((e,t)=>(e[t]=!0,e),{}),[e.Symbol.static]:Reflect.ownKeys(i).filter(e=>!n.includes(e)).reduce((e,t)=>(e[t]=!0,e),{}),[e.Symbol.proxy]:e.anyObjectProxyhandler}}const d=[e.Symbol.static,e.Symbol.proxy,e.Symbol.constructor],u=c[e.Symbol.static],m=c[e.Symbol.proxy],p=c[e.Symbol.constructor],b=n(a,i,s,p),f=(t,n)=>{const a=e.parent.Reflect.getOwnPropertyDescriptor(t,n);if(!a){const a=e.parent.Reflect.getPrototypeOf(t);return a?f(a,n):void 0}return a},g=(n,a,o,r)=>t.isObject(r)?Reflect.defineProperty(n,o,r):(r=f(a,o),!r)?(e.debug&&e.console.warn(`'${o}' is not included in the prototype of '${a.toString()}'`),!1):(Reflect.ownKeys(r).forEach(t=>{r[t]=e.toVirtualAny(r[t])}),Reflect.defineProperty(n,o,r));return u&&Reflect.ownKeys(u).forEach(e=>{const t=u[e];t&&g(b,i,e,t)}),Reflect.ownKeys(c).filter(e=>!d.includes(e)).forEach(e=>{const t=c[e];t&&g(b.prototype,i.prototype,e,t)}),m&&Reflect.defineProperty(b.prototype,e.Symbol.proxy,{value:m}),b},e.anyObjectProxyhandler=["getPrototypeOf","setPrototypeOf","isExtensible","preventExtensions","getOwnPropertyDescriptor","defineProperty","has","get","set","deleteProperty","ownKeys","apply","construct"].reduce((t,n)=>(t[n]=(...t)=>e.toVirtualAny(Reflect[n](...t.map(t=>e.toNativeAny(t)))),t),{})},Ne=(e,t)=>{const n=e.compartment,a=e.debug?Ee(e,t):n.evaluate(Ee.toString())(e,t);return a.helpers=e.debug?Se(a,t):n.evaluate(Se.toString())(a,t),a};const Oe=Object.seal(/^data-[\-\w.\u00B7-\uFFFF]/),Ce=Object.seal(/^aria-[\-\w]+$/),we=Object.seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Te=Object.seal(/^(?:\w+script|data):/i),Ae=Object.seal(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),{document:xe}=window,Re=e=>{if("string"==typeof e&&["","module","application/javascript","application/ecmascript","text/javascript","text/ecmascript"].includes(e.trim().toLowerCase()))return!0;let t=window.WEBSANDBOX_PREVENT_SCRIPT_TYPE;if(t||(t=window.WEBSANDBOX_PREVENT_SCRIPT_TYPE=new Map),t.has(e))return t.get(e);t.set(e,!1);const n=xe.createElement("script");n.setAttribute("type",e),n.textContent=`${"WEBSANDBOX_PREVENT_SCRIPT_TYPE"}.set(${JSON.stringify(e)}, true)`,xe.head.appendChild(n);const a=t.get(e);return xe.head.removeChild(n),a},{Node:je,NodeFilter:Le,Text:ke,Comment:Pe,NamedNodeMap:Me,DocumentFragment:De,document:Ie}=window,Ve=["iframe","noscript","embed","object","base"],_e=["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","plaintext","script","style","svg","template","thead","title","video","xmp"],Fe=["audio","video","img","source","image","track"],He=["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"],We=Ie.createElement("form"),Ue=e=>{try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=""}},ze=e=>{const t=e.match(/^[\r\n\t ]+/),n=t&&t[0],a=Ie.implementation.createHTMLDocument(""),{body:o}=a;return o.innerHTML=e,e&&n&&a.body.insertBefore(Ie.createTextNode(n),a.body.childNodes[0]||null),o},Ge=e=>(e.ownerDocument||e).createNodeIterator(e,Le.SHOW_ELEMENT|Le.SHOW_COMMENT|Le.SHOW_TEXT,()=>Le.FILTER_ACCEPT,!1),Ke=e=>!(e instanceof ke||e instanceof Pe)&&!("string"==typeof e.nodeName&&"string"==typeof e.textContent&&"function"==typeof e.removeChild&&e.attributes instanceof Me&&"function"==typeof e.removeAttribute&&"function"==typeof e.setAttribute&&"string"==typeof e.namespaceURI),Be=e=>"object"==typeof je?e instanceof je:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName;class qe{constructor(e={}){this.config=e}executeHook(e,t,n){const a=this.config[e];a&&a.call(this,t,n,this.config)}sanitizeElements(e){const{allowElements:t,blockElements:n,dropElements:a}=this.config;if(this.executeHook("beforeSanitizeElements",e,null),Ke(e))return Ue(e),!0;if(e.nodeName.match(/[\u0080-\uFFFF]/))return Ue(e),!0;const o=e.nodeName.toLowerCase();if(this.executeHook("uponSanitizeElement",e,{tagName:o,allowElements:t}),Ve.includes(o))return Ue(e),!0;if("script"===o&&!e.type)return Ue(e),!0;if(("svg"===o||"math"===o)&&0!==e.querySelectorAll("p, br, form, table, h1, h2, h3, h4, h5, h6").length)return Ue(e),!0;if(!Be(e.firstElementChild)&&(!Be(e.content)||!Be(e.content.firstElementChild))&&/<[/\w]/g.test(e.innerHTML)&&/<[/\w]/g.test(e.textContent))return Ue(e),!0;if(a&&a.includes(o)||n&&n.includes(o)||t&&t.length&&!t.includes(o)){const t=a&&!a.includes(o);if(t&&!_e.includes(o)&&"function"==typeof e.insertAdjacentHTML)try{const t=e.innerHTML;e.insertAdjacentHTML("AfterEnd",t)}catch(e){}return Ue(e),!0}return("noscript"===o||"noembed"===o)&&/<\/no(script|embed)/i.test(e.innerHTML)?(Ue(e),!0):(this.executeHook("afterSanitizeElements",e,null),!1)}isValidAttribute(e,t,n){const{allowAttributes:a,dropAttributes:o}=this.config,r=e.toLowerCase(),i=t.toLowerCase();if(("id"===i||"name"===i)&&(n in Ie||n in We))return!1;if(0===i.indexOf("on")||"script"===r&&"type"===i&&Re(n))return!1;if(Oe.test(i));else if(Ce.test(i));else{if(o&&o.includes(i)||a&&a.length&&!a.includes(i))return!1;if(He.includes(i));else if(we.test(n.replace(Ae,"")));else if(("src"===i||"xlink:href"===i||"href"===i)&&"script"!==r&&0===n.indexOf("data:")&&Fe.includes(r));else if(!Te.test(n.replace(Ae,"")));else if(!n);else return!1}return!0}sanitizeAttributes(e){const{allowAttributes:t}=this.config,n=e.nodeName;let a,o,r,i;this.executeHook("beforeSanitizeAttributes",e,null);const{attributes:s}=e;if(s){const l={name:"",value:"",keep:!0,allowAttributes:t};for(i=s.length;i--;){a=s[i];const{name:t,namespaceURI:c}=a;if((o=a.value.trim(),r=t,l.name=r,l.value=o,l.keep=void 0,this.executeHook("uponSanitizeAttribute",e,l),o=l.value,!l.keep)&&!this.isValidAttribute(n,r,o))try{c?e.removeAttributeNS(c,t):e.removeAttribute(t)}catch(e){}}this.executeHook("afterSanitizeAttributes",e,null)}}sanitizeShadowDOM(e){let t;const n=Ge(e);for(this.executeHook("beforeSanitizeShadowDOM",e,null);t=n.nextNode();)(this.executeHook("uponSanitizeShadowNode",t,null),!this.sanitizeElements(t))&&(t.content instanceof De&&this.sanitizeShadowDOM(t.content),this.sanitizeAttributes(t));this.executeHook("afterSanitizeShadowDOM",e,null)}sanitizeToString(e){if(e=`${e}`,-1===e.indexOf("<"))return e;const t=ze(e);if(!t)return"";const n=Ge(t);for(let t;t=n.nextNode();)this.sanitizeElements(t)||(t.content instanceof De&&this.sanitizeShadowDOM(t.content),this.sanitizeAttributes(t));const a=t.innerHTML;return a}}var Xe=e=>{const t=[],n=[],a=[],o=t=>{if(!["https:","http:"].includes(new e.top.URL(t,e.top.document.baseURI).protocol))throw new e.WebSandboxSecurityError(`Forbidden: url [${JSON.stringify(t)}]`)};return{name:e.name,[Symbol.toStringTag]:"Window",window:e.global,self:e.global,constructor:e.classRegistry.get("Window"),console:e.console,localStorage:e.toVirtualObject(e.parent.localStorage),navigator:e.toVirtualObject(e.parent.navigator),customElements:e.toVirtualObject(e.parent.customElements),document:(()=>{const t=e.toVirtualObject(e.view.shadowRoot,e.classRegistry.get("HTMLDocument")),n=t.createElement("html"),a=t.createElement("head"),o=t.createElement("title"),r=t.createElement("body");o.textContent=e.name,a.appendChild(o);const i=t.createElement("style");return i.textContent=`body { height: min-content }`,a.appendChild(i),Object.entries({defaultView:e.global,documentElement:t.appendChild(n),head:n.appendChild(a),body:n.appendChild(r),nodeName:"#document",nodeType:9}).forEach(([e,n])=>{Reflect.defineProperty(t,e,{writable:!1,configurable:!1,enumerable:!0,value:n})}),t})(),location:Object.defineProperties(e.toVirtualObject(e.parent.location),{...["href","protocol","host","hostname","port","pathname","search","hash","username","password","origin"].reduce((t,n)=>(t[n]={enumerable:!0,get(){return e.parent.location[n]},set(t){e.allow.topNavigation?(["href","protocol"].includes(n)&&o(t),e.parent.location[n]=t):e.console.error(`The document is sandboxed, and the 'allow-top-navigation' keyword is not set.`)}},t),{}),...["assign","reload","replace"].reduce((t,n)=>(t[n]={enumerable:!0,value(...t){e.allow.topNavigation?(["assign","replace"].includes(n)&&o(t[0]),e.parent.location[n](...t)):e.console.error(`The document is sandboxed, and the 'allow-top-navigation' keyword is not set.`)}},t),{}),...{toString:{enumerable:!0,value(){return this.href}}}}),close(){this.dispatchEvent(new this.Event("beforeunload")),this.dispatchEvent(new this.Event("pagehide")),this.dispatchEvent(new this.Event("unload")),t.forEach(e=>this.clearTimeout(e)),n.forEach(e=>this.clearInterval(e)),a.forEach(e=>this.cancelAnimationFrame(e)),this.document.removeChild(this.document.documentElement)},setTimeout(n,...a){if("string"==typeof n)throw new e.WebSandboxSecurityError(`The first parameter must be a function`);return t.push(e.parent.setTimeout(n.bind(this),...a))},clearTimeout(n){const a=t.indexOf(n);-1!==a&&(t.splice(a,1),e.parent.clearTimeout(n))},setInterval(t,...a){if("string"==typeof t)throw new e.WebSandboxSecurityError(`The first parameter must be a function`);return n.push(e.parent.setInterval(t.bind(this),...a))},clearInterval(t){const a=n.indexOf(t);-1!==a&&(n.splice(a,1),e.parent.clearInterval(t))},requestAnimationFrame(t){return a.push(e.parent.requestAnimationFrame(t.bind(this)))},cancelAnimationFrame(t){const n=a.indexOf(t);-1!==n&&(a.splice(n,1),e.parent.cancelAnimationFrame(t))},getComputedStyle(t,n){const a=e.toNativeObject(t),o=e.parent.getComputedStyle(a,n);return e.toVirtualObject(o)},atob(){return e.parent.atob(...arguments)},btoa(){return e.parent.btoa(...arguments)},addEventListener:e.toVirtualFunction(e.view.addEventListener),removeEventListener:e.toVirtualFunction(e.view.removeEventListener),dispatchEvent:e.toVirtualFunction(e.view.dispatchEvent)}};const Ye={HTMLCanvasElement:()=>({width:!0,height:!0,captureStream:!0,getContext:!0,toDataURL:!0,toBlob:!0,transferControlToOffscreen:!0}),HTMLImageElement:e=>{const t=(t,n,a)=>{if(!e.sanitizer.isValidAttribute(t.nodeName,n,a))throw new e.WebSandboxSecurityError(`Forbidden: attribute [${n}=${JSON.stringify(a)}]`)},n=n=>({get(){const t=e.toNativeObject(this),a=t.getAttribute(n),o=null===a?"":new e.top.URL(a,t.baseURI).href;return o},set(a){const o=n,r=e.toNativeObject(this);t(r,o,a),r.setAttribute(o,a)}});return{alt:!0,src:n("src"),srcset:n("srcset"),sizes:!0,crossOrigin:!0,useMap:!0,isMap:!0,width:!0,height:!0,naturalWidth:!0,naturalHeight:!0,complete:!0,currentSrc:!0,referrerPolicy:!0,decoding:!0,x:!0,y:!0,decode:!0,loading:!0}},HTMLInputElement:()=>({accept:!0,alt:!0,autocomplete:!0,defaultChecked:!0,checked:!0,dirName:!0,disabled:!0,form:!0,files:!0,formAction:!0,formEnctype:!0,formMethod:!0,formNoValidate:!0,formTarget:!0,height:!0,indeterminate:!0,list:!0,max:!0,maxLength:!0,min:!0,minLength:!0,multiple:!0,name:!0,pattern:!0,placeholder:!0,readOnly:!0,required:!0,size:!0,src:!0,step:!0,type:!0,defaultValue:!0,value:!0,valueAsDate:!0,valueAsNumber:!0,width:!0,willValidate:!0,validity:!0,validationMessage:!0,labels:!0,selectionStart:!0,selectionEnd:!0,selectionDirection:!0,align:!0,useMap:!0,incremental:!0,checkValidity:!0,reportValidity:!0,select:!0,setCustomValidity:!0,setRangeText:!0,setSelectionRange:!0,stepDown:!0,stepUp:!0}),HTMLLinkElement:()=>({href:!0,rel:!0}),HTMLScriptElement:e=>{const t=e.sandboxScriptType,n=e=>e.replace(/\.import\(/g,`['import'](`),a=(t,n,a)=>{if(!e.sanitizer.isValidAttribute(t.nodeName,n,a))throw new e.WebSandboxSecurityError(`Forbidden: attribute [${n}=${JSON.stringify(a)}]`)},o=(t,n=e=>e)=>({get(){const a=e.toNativeObject(this),o=a.getAttribute(t);return null===o?"":n(o,this)},set(n){const o=t,r=e.toNativeObject(this);a(r,o,n),r.setAttribute(o,n)}});return{src:o("src",(t,n)=>new e.top.URL(t,n.baseURI).href),charset:!0,async:!0,defer:!0,crossOrigin:!0,text:!0,noModule:!0,referrerPolicy:!0,type:o("type"),[e.Symbol.createdCallback]:{value(){const n=e.toNativeObject(this);n.setAttribute("type",t)}},[e.Symbol.connectedCallback]:{value(){const a=e.toNativeObject(this);if(a.getAttribute("type")!==t)return;const o=e.global.Error,r=e.classRegistry.get("Event"),i=e.classRegistry.get("ErrorEvent"),l=e.top.fetch,s=a.src,c=t=>{t=n(t);try{e.compartment.evaluate(t)}catch(e){this.ownerDocument.defaultView.dispatchEvent(new i("error",e))}this.dispatchEvent(new r("load"))};if(s){if(!e.allow.importScripts)return void e.console.error(`The document is sandboxed, and the 'allow-import-scripts' keyword is not set.`);l(s,{}).then(e=>{if(!e.ok)throw o([e.status,e.statusText,s].join(", "));const t=e.headers.get("content-type");if(!t||!/^(text|application)\/(x-)?javascript(;|$)/.test(t))throw o(t);return e.text().then(e=>{0>e.indexOf("//# sourceURL=")&&(e+=`\n//# sourceURL=${s}`),c(e)})})}else c(this.textContent)}}}},HTMLTemplateElement:()=>({content:!0}),HTMLUnknownElement:()=>({})};var Je=e=>{const t=t=>e.classRegistry.get(t),n=n=>{const a=e.parent.document.createElement(n)[e.parent.Symbol.toStringTag],o=t(a)?t(a):e.classGenerator(a,()=>({}));return o&&(e.classRegistry.define(a,o),e.elementRegistry.define(n,o)),o};return Object.entries(Ye).forEach(([t,n])=>{const a=e.classGenerator(t,n);a&&e.classRegistry.define(t,a)}),Object.entries({a:!0,abbr:!0,address:!0,area:!0,article:!0,aside:!0,audio:!1,b:!0,base:!0,bdi:!0,bdo:!0,blockquote:!0,body:!0,br:!0,button:!0,canvas:!0,caption:!0,cite:!0,code:!0,col:!0,colgroup:!0,data:!0,datalist:!0,dd:!0,del:!0,details:!0,dfn:!0,dialog:!0,div:!0,dl:!0,dt:!0,em:!0,embed:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,head:!0,header:!0,hr:!0,html:!0,i:!0,iframe:!0,img:!0,input:!0,ins:!0,kbd:!0,label:!0,legend:!0,li:!0,link:!0,main:!0,map:!0,mark:!0,meta:!0,meter:!0,nav:!0,noscript:!0,object:!0,ol:!0,optgroup:!0,option:!0,output:!0,p:!0,param:!0,picture:!0,pre:!0,progress:!0,q:!0,rb:!0,rp:!0,rt:!0,rtc:!0,ruby:!0,s:!0,samp:!0,script:!0,section:!0,select:!0,slot:!0,small:!0,source:!0,span:!0,strong:!0,style:!0,sub:!0,summary:!0,sup:!0,table:!0,tbody:!0,td:!0,template:!0,textarea:!0,tfoot:!0,th:!0,thead:!0,time:!0,title:!0,tr:!0,track:!0,u:!0,ul:!0,var:!0,video:!1,wbr:!0}).reduce((e,[a,o])=>(o&&(!0===o&&(t(a)?o=t(a):o=n(a)),e[o.name]=o),e),{})},Qe=e=>{const t=t=>e.classRegistry.get(t),n=t=>{const n=e.classGenerator(t,()=>!0);return n&&e.classRegistry.define(t,n),n};return Object.entries({CSSRule:!0,CSSGroupingRule:!0,StyleSheet:!0,CSSConditionRule:!0,CSSKeyframeRule:!0,CSSKeyframesRule:!0,CSSMediaRule:!0,CSSNamespaceRule:!0,CSSPageRule:!0,CSSRuleList:!0,CSSStyleDeclaration:!0,CSSStyleRule:!0,CSSStyleSheet:!0,CSSSupportsRule:!0,MediaQueryList:!0,Screen:!0,StyleSheetList:!0}).reduce((e,[a,o])=>(o&&(!0===o&&(t(a)?o=t(a):o=n(a)),o&&(e[o.name]=o)),e),{})};const Ze={CompositionEvent:()=>({data:!0}),ErrorEvent:()=>({message:!0,filename:!0,lineno:!0,colno:!0,error:!0}),HashChangeEvent:()=>({newURL:!0,oldURL:!0}),InputEvent:()=>({data:!0,isComposing:!0}),KeyboardEvent:()=>({key:!0,code:!0,location:!0,ctrlKey:!0,shiftKey:!0,altKey:!0,metaKey:!0,repeat:!0,isComposing:!0,charCode:!0,keyCode:!0,DOM_KEY_LOCATION_STANDARD:!0,DOM_KEY_LOCATION_LEFT:!0,DOM_KEY_LOCATION_RIGHT:!0,DOM_KEY_LOCATION_NUMPAD:!0,getModifierState:!0,initKeyboardEvent:!0}),MouseEvent:()=>({altKey:!0,button:!0,buttons:!0,ctrlKey:!0,metaKey:!0,offsetX:!0,offsetY:!0,relatedTarget:!0,shiftKey:!0,x:!1,y:!1})};var $e=e=>{const t={};return Object.entries(Ze).forEach(([n,a])=>{const o=e.classGenerator(n,a);o&&(e.classRegistry.define(n,o),t[n]=o)}),t};const et={EventTarget:()=>({addEventListener:!0,removeEventListener:!0,dispatchEvent:!0}),Node:e=>({baseURI:!0,childNodes:!0,firstChild:!0,isConnected:!0,lastChild:!0,nextSibling:!0,nodeName:!0,nodeType:!0,nodeValue:!0,ownerDocument:{get(){const t=e.global.document;return t===this?null:t}},parentNode:{get(){const t=e.toNativeObject(this).parentNode;return null===t?null:t===e.parent.document?this.ownerDocument:e.toVirtualObject(t)}},previousSibling:!0,textContent:!0,appendChild:!0,cloneNode:!0,compareDocumentPosition:!0,contains:!0,getRootNode:!0,hasChildNodes:!0,insertBefore:!0,isDefaultNamespace:!0,isEqualNode:!0,isSameNode:!0,lookupPrefix:!0,lookupNamespaceURI:!0,normalize:!0,removeChild:!0,replaceChild:!0,[e.Symbol.static]:{ELEMENT_NODE:!0,TEXT_NODE:!0,CDATA_SECTION_NODE:!0,PROCESSING_INSTRUCTION_NODE:!0,COMMENT_NODE:!0,DOCUMENT_NODE:!0,DOCUMENT_TYPE_NODE:!0,DOCUMENT_FRAGMENT_NODE:!0}}),DocumentFragment:()=>({children:!0,firstElementChild:!0,lastElementChild:!0,childElementCount:!0,append:!0,getElementById:!0,prepend:!0,querySelector:!0,querySelectorAll:!0,replaceChildren:!0,childNodes:!0}),Document:(e,t)=>{const n=t=>({value(){const n=[...arguments].map(t=>e.toNativeAny(t)),a=e.parent.document[t](...n),o=e.toVirtualAny(a);return o}}),a=t=>{t=t.toLowerCase();const n=e.sanitizer.config,a=n.dropElements&&n.dropElements.includes(t);if(a||n.allowElements&&n.allowElements.includes(t))throw new e.WebSandboxSecurityError(`Forbidden: tag <${t} />`)},o=t=>t.includes("-")&&e.elementRegistry.get(t)&&!e.parent.customElements.get(t),r=function(n,a,o){if(o)throw new SyntaxError(`CustomElement: Options not supported: ${JSON.stringify(o)}`);const r=e.elementRegistry.get(a),i=r.constructor,l=Reflect.construct(i,[]),s=e.toNativeObject(l),c=t.inherits(l,Object.create(i.prototype));if(s.setAttribute(e.sandboxElementDefined,""),r.observedAttributes.length&&c.attributeChangedCallback){const t=new e.parent.MutationObserver(e=>{e.forEach(({target:e,attributeName:t,oldValue:n})=>{c.attributeChangedCallback(t,n,e.getAttribute(t))})});t.observe(s,{attributes:!0,attributeOldValue:!0,attributeFilter:r.observedAttributes})}return e.toNativeObject.cache.set(c,s),e.toVirtualObject.cache.set(s,c),c},i=n("createAttribute"),l=n("createAttributeNS"),s=n("createCDATASection"),c=n("createComment"),d=n("createDocumentFragment"),u=n("createElement"),m=n("createElementNS"),p=n("createEvent"),b=n("createProcessingInstruction"),f=n("createTextNode"),g=n("createTreeWalker"),y=n("importNode");return{nodeName:{get(){return e.parent.document.nodeName}},nodeType:{get(){return e.parent.document.nodeType}},body:{get(){return this.querySelector("body")}},documentElement:{get(){return this.querySelector("html")}},head:{get(){return this.querySelector("head")}},title:{get(){return this.querySelector("title").textContent},set(e){this.querySelector("title").textContent=e}},hidden:{get(){return e.parent.document.hiddent}},visibilityState:{get(){return e.parent.document.visibilityState}},childElementCount:!0,children:!0,firstElementChild:!0,lastElementChild:!0,readyState:{get(){return e.parent.document.readyState}},activeElement:!0,createAttribute:i,createAttributeNS:l,createCDATASection:s,createComment:c,createDocumentFragment:d,createElement:{value(e,t){a(e);const n=[e,t];return o(e)?r.apply(this,[null,...n]):u.value.apply(this,n)}},createElementNS:{value(e,t,n){a(t);const i=[e,t,n];return o(t)?r.apply(this,i):m.value.apply(this,i)}},createEvent:p,createProcessingInstruction:b,createTextNode:f,createTreeWalker:g,importNode:y,getElementById:!0,querySelector:!0,querySelectorAll:!0}},CharacterData:()=>({data:!0,length:!0,nextElementSibling:!0,previousElementSibling:!0}),Element:e=>{const t=(t,n)=>({value(){const[a,o]=n(arguments),r=e.toNativeObject(this),i=r.nodeName,l=0===t.indexOf("set");if(l&&!e.sanitizer.isValidAttribute(i,a,o)||a.includes(e.sandboxAttribute)||l&&o.includes(e.sandboxAttribute))throw new e.WebSandboxSecurityError(`Forbidden: attribute [${a}=${JSON.stringify(o)}]`);const s=r[t](...arguments);return s}}),n=t("setAttribute",e=>e),a=t("setAttributeNS",e=>[e[1],e[2]]),o=t("setAttributeNode",e=>[e[0].name,e[0].value]),r=t("setAttributeNodeNS",e=>[e[1].name,e[1].value]),i=t("removeAttribute",e=>[e[0]]),l=t("removeAttributeNS",e=>[e[1]]);return{attributes:!0,childElementCount:!0,children:!0,classList:!0,className:!0,clientHeight:!0,clientLeft:!0,clientTop:!0,clientWidth:!0,firstElementChild:!0,id:!0,innerHTML:{set(t){const n=e.toNativeObject(this),a=e.sanitizer.sanitizeToString(t);n.innerHTML=a},get(){return e.toNativeObject(this).innerHTML}},lastElementChild:!0,localName:!0,namespaceURI:!0,nextElementSibling:!0,outerHTML:{set(t){const n=e.toNativeObject(this),a=e.sanitizer.sanitizeToString(t);n.outerHTML=a},get(){return e.toNativeObject(this).outerHTML}},part:!0,prefix:!0,previousElementSibling:!0,scrollHeight:!0,scrollLeft:!0,scrollTop:!0,scrollWidth:!0,shadowRoot:!0,slot:!0,tagName:!0,after:!0,animate:!0,append:!0,attachShadow:!0,before:!0,closest:!0,getAttribute:!0,getAttributeNames:!0,getAttributeNS:!0,getBoundingClientRect:!0,getClientRects:!0,getElementsByClassName:!0,getElementsByTagName:!0,getElementsByTagNameNS:!0,hasAttribute:!0,hasAttributeNS:!0,hasAttributes:!0,matches:!0,querySelector:!0,querySelectorAll:!0,remove:!0,removeAttribute:i,removeAttributeNS:l,scroll:!0,scrollBy:!0,scrollIntoView:!0,scrollTo:!0,setAttribute:n,setAttributeNS:a,setAttributeNode:o,setAttributeNodeNS:r}},Event:e=>({bubbles:!0,cancelable:!0,composed:{get(){return!1}},currentTarget:!0,defaultPrevented:!0,eventPhase:!0,target:!0,timeStamp:!0,type:!0,composedPath:{value(){const t=e.global,n=e.view.shadowRoot,a=e.toNativeObject(this).composedPath();return a.filter(t=>t===e.parent||t instanceof e.parent.Node&&n.contains(t)).map(n=>n===e.parent?t:e.toVirtualObject(n))}},initEvent:!0,preventDefault:!0,stopImmediatePropagation:!0,stopPropagation:!0}),UIEvent:()=>({detail:!0}),DOMTokenList:()=>!0,Attr:()=>({name:!0,namespaceURI:!0,localName:!0,prefix:!0,ownerElement:!0,specified:!0,value:!0}),CanvasGradient:()=>({addColorStop:!0}),CanvasPattern:()=>({setTransform:!0}),CanvasRenderingContext2D:e=>({canvas:!0,direction:!0,fillStyle:{get(){return e.toNativeObject(this).fillStyle},set(t){e.toNativeObject(this).fillStyle=t}},filter:!0,font:!0,globalAlpha:!0,globalCompositeOperation:!0,imageSmoothingEnabled:!0,imageSmoothingQuality:!0,lineCap:!0,lineDashOffset:!0,lineJoin:!0,lineWidth:!0,miterLimit:!0,shadowBlur:!0,shadowColor:!0,shadowOffsetX:!0,shadowOffsetY:!0,strokeStyle:{get(){return e.toNativeObject(this).strokeStyle},set(t){e.toNativeObject(this).strokeStyle=t}},textAlign:!0,textBaseline:!0,...Object.entries({arc:!0,arcTo:!0,beginPath:!0,bezierCurveTo:!0,clearRect:!0,clip:!0,closePath:!0,createImageData:!0,createLinearGradient:!0,createPattern:{value(t,n){const a=e.toNativeObject(t);return e.toNativeObject(this).createPattern(a,n)}},createRadialGradient:!0,drawFocusIfNeeded:{value(...t){return 1===t.length?t[0]=e.toNativeObject(t[0]):t[1]=e.toNativeObject(t[1]),e.toNativeObject(this).drawFocusIfNeeded(...t)}},drawImage:{value(t,...n){const a=e.toNativeObject(t);return e.toNativeObject(this).drawImage(a,...n)}},ellipse:!0,fill:!0,fillRect:!0,fillText:!0,getImageData:!0,getLineDash:!0,getTransform:!0,isPointInPath:!0,isPointInStroke:!0,lineTo:!0,measureText:!0,moveTo:!0,putImageData:!0,quadraticCurveTo:!0,rect:!0,resetTransform:!0,restore:!0,rotate:!0,save:!0,scale:!0,setLineDash:!0,setTransform:!0,stroke:!0,strokeRect:!0,strokeText:!0,transform:!0,translate:!0}).reduce((t,[n,a])=>(t[n]=!0===a?{value(){return e.toNativeObject(this)[n](...arguments)}}:a,t),{})}),Comment:()=>({}),CustomElementRegistry:(e,t)=>{const n=new Map;return{define:{value(t,a,o){if(!t.includes("-")&&e.elementRegistry.has(t))throw new TypeError(`Illegal constructor`);e.elementRegistry.define(t,a,o);const r=[...e.global.document.querySelectorAll(t)].filter(e=>!(e instanceof a));if(r.forEach(e=>{this.upgrade(e)}),n.has(t))for(let e;e=n.get(t).shift();)e()}},get:{value(t){return(e.elementRegistry.get(t)||{}).constructor}},upgrade:{value(n){const a=e.toNativeObject(n),o=n.localName,r=this.get(o),i=Reflect.construct(r,[]);if(n instanceof r)throw new TypeError(`Illegal constructor`);Reflect.setPrototypeOf(n,t.inherits(i,Object.create(r.prototype))),a.setAttribute(e.sandboxElementDefined,""),e.toNativeObject.cache.set(n,a),e.toVirtualObject.cache.set(a,n)}},whenDefined:{value(t){return e.elementRegistry.has(t)?Promise.resolve():new Promise((e)=>{n.has(t)||n.set(t,[]),n.get(t).push(e)})}}}},DOMStringMap:()=>({}),HTMLCollection:()=>!0,HTMLDocument:()=>({}),HTMLElement:e=>({[e.Symbol.constructor]:function t(){if(new.target===t)throw TypeError(`Illegal constructor`);const n=[...e.elementRegistry.values()].find(e=>e.constructor===new.target),a=n?n.name:"web-sandbox-custom-element",o=e.parent.document.createElement(a);return e.toVirtualObject(o)},accessKey:!0,dataset:!0,dir:!0,draggable:!0,hidden:!0,innerText:!0,lang:!0,offsetHeight:!0,offsetLeft:!0,offsetParent:!0,offsetTop:!0,offsetWidth:!0,spellcheck:!0,style:!0,tabIndex:!0,title:!0,blur:!0,click:!0,focus:!0}),Location:()=>({}),MutationObserver:()=>({disconnect:!0,observe:!0,takeRecords:!0}),MutationRecord:()=>({type:!0,target:!0,addedNodes:!0,removedNodes:!0,previousSibling:!0,nextSibling:!0,attributeName:!0,attributeNamespace:!0,oldValue:!0}),NamedNodeMap:()=>!0,Navigator:()=>({language:!0,languages:!0,onLine:!0,userAgent:!0,cookieEnabled:{get(){return!1}}}),NodeList:()=>!0,OffscreenCanvas:()=>({height:!0,width:!0,convertToBlob:!0,getContext:!0,transferToImageBitmap:!0}),ShadowRoot:e=>({mode:!0,host:!0,innerHTML:{set(t){const n=e.toNativeObject(this),a=e.sanitizer.sanitizeToString(t);n.innerHTML=a},get(){return e.toNativeObject(this).innerHTML}},delegatesFocus:!0,activeElement:!0,styleSheets:!0}),Storage:e=>{const t=`websandbox/${e.name}`;return{length:{get(){throw new e.WebSandboxSecurityError(`Forbidden: Storage.length`)}},key:{value(){throw new e.WebSandboxSecurityError(`Forbidden: Storage.key()`)}},getItem:{value(n){return e.toNativeObject(this).getItem(`${t}/${n}`)}},setItem:{value(n,a){return e.toNativeObject(this).setItem(`${t}/${n}`,a)}},removeItem:{value(n){return e.toNativeObject(this).removeItem(`${t}/${n}`)}},clear:{value(){const n=e.toNativeObject(this);Reflect.ownKeys(n).filter(e=>0===e.indexOf(t)).forEach(e=>n.removeItem(e))}},[e.Symbol.proxy]:{get(t,n){const a=e.toVirtualObject(t);return"string"==typeof n?a.getItem(n):void 0},set(t,n,a){const o=e.toVirtualObject(t);return"string"==typeof n&&(o.setItem(n,a),!0)},deleteProperty(t,n){const a=e.toVirtualObject(t);return"string"==typeof n&&(a.removeItem(n),!0)}}}},Text:()=>({wholeText:!0}),TreeWalker:()=>({root:!0,whatToShow:!0,filter:!0,currentNode:!0,firstChild:!0,lastChild:!0,nextNode:!0,nextSibling:!0,parentNode:!0,previousNode:!0,previousSibling:!0}),Window:()=>({})},tt=e=>Object.entries(et).reduce((t,[n,a])=>{const o=e.classGenerator(n,a);return o&&(e.classRegistry.define(n,o),t[n]=o),t},{});let nt;const at=window,ot=Symbol("importScript"),rt=Symbol("compartment"),it=Symbol("sandbox"),lt=e=>{const t=Ne(e,{Sanitizer:qe,isJavaScriptType:Re,isObject:T,isFunction:A,inherits:x}),n=e.compartment,a=n.global,o=e.debug,r=e.parent,i=e.view;["Object","Array","Promise"].forEach(e=>{t.classRegistry.define(e,t.classGenerator(e,{[t.Symbol.proxy]:t.anyObjectProxyhandler}))}),Object.assign(a,tt(t),Je(t),Qe(t),$e(t)),Object.assign(a,o?Xe(t):n.evaluate(Xe.toString())(t)),["window","document","location","close"].forEach(e=>{Reflect.defineProperty(a,e,{writable:!1,configurable:!1,enumerable:!0})}),t.toNativeObject.cache.set(a,i),t.toVirtualObject.cache.set(i,a),r.setTimeout(()=>{a.dispatchEvent(new a.Event("DOMContentLoaded")),a.dispatchEvent(new a.Event("load"))},4),r.addEventListener("hashchange",e=>{const n=t.toVirtualObject(new e.constructor(e.type,{newUrl:e.newURL,oldURL:e.oldURL}));a.dispatchEvent(n)});const l=e=>{const n=t.toVirtualObject(e);n[t.Symbol.connectedCallback]?n[t.Symbol.connectedCallback]():t.elementRegistry.has(n.localName)&&n.connectedCallback&&n.connectedCallback(),e.childNodes.forEach(l)},s=e=>{const n=t.toVirtualObject(e);n[t.Symbol.disconnectedCallback]?n[t.Symbol.disconnectedCallback]():t.elementRegistry.has(n.localName)&&n.disconnectedCallback&&n.disconnectedCallback(),e.childNodes.forEach(s)},c=new t.parent.MutationObserver(e=>{e.forEach(e=>{if("childList"===e.type){const{addedNodes:n,removedNodes:a}=e;try{n.forEach(l),a.forEach(s)}catch(e){t.debug&&t.console.errror(e)}}})});return c.observe(i.shadowRoot,{childList:!0,subtree:!0}),t.allow.topNavigation||a.document.addEventListener("click",e=>{"a"===e.target.nodeName.toLowerCase()&&(t.console.error(`The document is sandboxed, and the 'allow-top-navigation' keyword is not set.`),e.preventDefault())}),Reflect.setPrototypeOf(a,a.Window.prototype),{global:a,bridge:t}},st=()=>{if(!nt){nt=ve.makeRootRealm();const e=window.document.body.lastChild;if("IFRAME"===e.nodeName&&e.contentWindow&&nt.global instanceof e.contentWindow.Object){const t=e.contentDocument;t.removeChild(t.documentElement)}}return nt.global.Realm.makeCompartment()},ct=e=>e.replace(/\.import\(/g,`['import'](`);class dt extends window.HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this[rt]=null,this[it]=window.document.createElement("i"),this.addEventListener("close",()=>{})}get[Symbol.toStringTag](){return"HTMLWebSandboxElement"}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get src(){return this.getAttribute("src")}set src(e){this.setAttribute("src",e)}get srcdoc(){return this.getAttribute("srcdoc")}set srcdoc(e){this.setAttribute("srcdoc",e)}get sandbox(){return this[it].classList}set sandbox(e){this.setAttribute("sandbox",e),this[it].classList=e}get contentWindow(){return this[rt].global}get contentDocument(){return this[rt].global.document}evaluate(e,t={}){return e=ct(e),this[rt].evaluate(e,t)}connectedCallback(){const e=this.debug,t=this.getAttribute("sandbox"),n=(e=>({importScripts:e,topNavigation:e}))(null===t);this.sandbox.forEach(e=>{n[e.replace(/^allow-/,"").replace(/-(\w)/g,(e,t)=>t.toUpperCase())]=!0});const a=st(),{bridge:o}=lt({name:this.name,view:this,allow:n,top:window,parent:window,compartment:a,debug:e});this[rt]=a;const r=o.classGenerator("HTMLWebSandboxElement",e=>({name:{get(){return e.toNativeObject(this).name},set(t){e.toNativeObject(this).name=`${e.name}/${t}`}},sandbox:!0,src:!0,srcdoc:!0,contentWindow:!0,contentDocument:!0,evaluate:!0}));o.classRegistry.define("HTMLWebSandboxElement",r),o.elementRegistry.define("web-sandbox",r),a.global.HTMLWebSandboxElement=r,this.srcdoc?(this.evaluate(this.srcdoc),this.dispatchEvent(new window.Event("load"))):this.src&&this[ot]().then(()=>{this.dispatchEvent(new window.Event("load"))})}disconnectedCallback(){this.contentWindow.close()}[ot](){const e=new at.URL(this.src,this.baseURI).href;return at.fetch(e,{}).then(t=>{if(!t.ok)throw Error([t.status,t.statusText,e].join(", "));const n=t.headers.get("content-type");if(!n||!/^(text|application)\/(x-)?javascript(;|$)/.test(n))throw Error(n);return t.text().then(t=>{0>t.indexOf("//# sourceURL=")&&(t+=`\n//# sourceURL=${e}`),this.evaluate(t)})})}}return Reflect.defineProperty(dt,"name",{value:"HTMLWebSandboxElement"}),Reflect.defineProperty(dt.prototype,"debug",{configurable:!0,enumerable:!1,writable:!0,value:(()=>{}).toString().includes("/**/")}),window.HTMLWebSandboxElement=dt,window.customElements.define("web-sandbox",dt),R.instantiate=function(e,t){const n=new R;return n.evaluate(e,t),n},R});
//# sourceMappingURL=web-sandbox.umd.js.map
