(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e=e||self,t(e.WebSandbox={}))})(this,function(e){'use strict';function t(e,t=void 0){const n=`please report internal shim error: ${e}`;console.error(n),t&&(console.error(`${t}`),console.error(`${t.stack}`));debugger;throw n}function n(e,n){e||t(n)}function a(e){let t=`'use strict'; (${e})`;return t=t.replace(/\(0,\s*_[0-9a-fA-F]{3}\u200D\.e\)/g,"(0, eval)"),t=t.replace(/_[0-9a-fA-F]{3}\u200D\.g\./g,""),t=t.replace(/cov_[^+]+\+\+[;,]/g,""),t}function r(e,t){const{callAndWrapError:n}=e,{initRootRealm:a,initCompartment:o,getRealmGlobal:i,realmEvaluate:l}=t,{create:s,defineProperties:c}=Object;class d{constructor(){throw new TypeError("Realm is not a constructor")}static makeRootRealm(t={}){const o=s(d.prototype);return n(a,[e,o,t]),o}static makeCompartment(t={}){const a=s(d.prototype);return n(o,[e,a,t]),a}get global(){return n(i,[this])}evaluate(e,t,a={}){return n(l,[this,e,t,a])}}return c(d,{toString:{value:()=>"function Realm() { [shim code] }",writable:!1,enumerable:!1,configurable:!0}}),c(d.prototype,{toString:{value:()=>"[object Realm]",writable:!1,enumerable:!1,configurable:!0}}),d}function o(e,t=!1){function a(t,a,o,i){for(const l of t){const t=B(e,l);t&&(n("value"in t,`unexpected accessor on global property: ${l}`),r[l]={value:t.value,writable:a,enumerable:o,configurable:i})}}const r={};return t?(a(re,!0,!1,!0),a(oe,!0,!1,!0)):(a(re,!1,!1,!1),a(oe,!1,!1,!1)),a(ie,!0,!1,!0),r}function i(){function e(e){if(e===void 0||null===e)throw new TypeError(`can't convert undefined or null to object`);return Object(e)}function t(e){return"symbol"==typeof e?e:`${e}`}function n(e,t){if("function"!=typeof e)throw TypeError(`invalid ${t} usage`);return e}const{defineProperty:a,defineProperties:r,getOwnPropertyDescriptor:o,getPrototypeOf:i,prototype:l}=Object;try{(0,l.__lookupGetter__)("x")}catch(e){return}r(l,{__defineGetter__:{value:function(t,r){const o=e(this);a(o,t,{get:n(r,"getter"),enumerable:!0,configurable:!0})}},__defineSetter__:{value:function(t,r){const o=e(this);a(o,t,{set:n(r,"setter"),enumerable:!0,configurable:!0})}},__lookupGetter__:{value:function(n){let a=e(this);n=t(n);let r;for(;a&&!(r=o(a,n));)a=i(a);return r&&r.get}},__lookupSetter__:{value:function(n){let a=e(this);n=t(n);let r;for(;a&&!(r=o(a,n));)a=i(a);return r&&r.set}}})}function l(){function e(e,r){let o;try{o=(0,eval)(r)}catch(t){if(t instanceof SyntaxError)return;throw t}const i=n(o),l=function(){throw new TypeError("Not available")};t(l,{name:{value:e}}),t(i,{constructor:{value:l}}),t(l,{prototype:{value:i}}),l!==Function.prototype.constructor&&a(l,Function.prototype.constructor)}const{defineProperties:t,getPrototypeOf:n,setPrototypeOf:a}=Object;e("Function","(function(){})"),e("GeneratorFunction","(function*(){})"),e("AsyncFunction","(async function(){})"),e("AsyncGeneratorFunction","(async function*(){})")}function s(){const e=new Function("try {return this===global}catch(e){return false}")();if(!e)return;const t=require("vm"),n=t.runInNewContext(se);return n}function c(){if("undefined"!=typeof document){const e=document.createElement("iframe");e.style.display="none",document.body.appendChild(e);const t=e.contentWindow.eval(le);return t}}function d(e,t=[],n=!1){const a=o(e,n),r=e.eval,i=e.Function,l=r(W)();return _({unsafeGlobal:e,sharedGlobalDescs:a,unsafeEval:r,unsafeFunction:i,callAndWrapError:l,allShims:t})}function u(e,t=!1){const n=ce(),a=d(n,e,t),{unsafeEval:r}=a;return r(de)(),r(ue)(),a}function m(e,t={}){const n=z(e),a=Z(n,n=>{if(n in t)return!1;if("eval"===n||pe.has(n)||!ne(me,n))return!1;const a=B(e,n);return!1===a.configurable&&!1===a.writable&&J(a,"value")});return a}function p(e){const t=e.search(he);if(-1!==t){const n=e.slice(0,t).split("\n").length;throw new SyntaxError(`possible html comment syntax rejected around line ${n}`)}}function f(e){const t=e.search(Se);if(-1!==t){const n=e.slice(0,t).split("\n").length;throw new SyntaxError(`possible import expression rejected around line ${n}`)}}function b(e){const t=e.search(ye);if(-1!==t){const n=e.slice(0,t).split("\n").length;throw new SyntaxError(`possible direct eval expression rejected around line ${n}`)}}function g(e){p(e),f(e),b(e)}function E(e){return 0===e.length?"":`const {${ee(e,",")}} = this;`}function h(e,t){const{unsafeFunction:n}=e,a=E(t);return n(`with (arguments[0]) {${a};return function() {'use strict';return eval(arguments[0]);};}`)}function S(e,n,a,r){const{unsafeEval:o}=e,i=o(Ee);return function(l={},s={}){const c=s.transforms||[],d=te(c,a||[],[ve]);return function(a){let s={src:a,endowments:l};s=i(s,d);const c=m(n,s.endowments),u=m(s.endowments),p=te(c,u),f=h(e,p),b=o(fe)(e,n,s.endowments,r),g=Proxy.revocable({},b),E=g.proxy,S=X(f,n,[E]);b.useUnsafeEvaluator=!0;let y;try{return X(S,n,[s.src])}catch(t){throw y=t,t}finally{b.useUnsafeEvaluator&&(g.revoke(),t("handler did not revoke useUnsafeEvaluator",y))}}}}function y(e,t){const{unsafeEval:a,unsafeFunction:r}=e,o=a(be)(e,t);return n(K(o).constructor!==Function,"hide Function"),n(K(o).constructor!==r,"hide unsafeFunction"),o}function v(e){return(t,n,a={})=>e(n,a)(t)}function C(e,t){const{unsafeGlobal:a,unsafeEval:r,unsafeFunction:o}=e,i=r(ge)(e,function(...e){const n=`${$(e)||""}`;let r=`${ee(e,",")}`;if(!ne(/^[\w\s,]*$/,r))throw new SyntaxError("shim limitation: Function arg must be simple ASCII identifiers, possibly separated by commas: no default values, pattern matches, or non-ASCII parameter names");if(new o(n),ae(r,")"))throw new a.SyntaxError("shim limitation: Function arg string contains parenthesis");0<r.length&&(r+="\n/*``*/");const i=`(function(${r}){\n${n}\n})`;return t(i)});return n(K(i).constructor!==Function,"hide Function"),n(K(i).constructor!==o,"hide unsafeFunction"),i}function T(e){return n(Object(e)===e,"bad object, not a Realm instance"),n(Ce.has(e),"Realm instance has no record"),Ce.get(e)}function N(e,t){n(Object(e)===e,"bad object, not a Realm instance"),n(!Ce.has(e),"Realm instance already has a record"),Ce.set(e,t)}function A(e,t,n){U(e,{eval:{value:t,writable:!0,configurable:!0},Function:{value:n,writable:!0,configurable:!0}})}function M(e,t,n){const{sharedGlobalDescs:a,unsafeGlobal:r}=e,o=F(r.Object.prototype,a),i=S(e,o,t,n),l=i(),s=y(e,l),c=C(e,l),d=v(i);A(o,s,c);const u=_({safeGlobal:o,safeEval:s,safeEvalWhichTakesEndowments:d,safeFunction:c});return u}function L(){if(!Le){Le=Ae.makeRootRealm();const e=window.document.body.lastChild;if("IFRAME"===e.nodeName&&e.contentWindow&&Le.global instanceof e.contentWindow.Object){const t=e.contentDocument;t.removeChild(t.documentElement),Object.defineProperties(e,{contentWindow:{},contentDocument:{}})}}const e=Le.global.Realm.makeCompartment(),t=e.evaluate;return e.evaluate=function(e,...n){return e=e.replace(/\.import\(/g,`['import'](`),t.call(this,e,...n)},Le.evaluate(Me.toString())({rootRealm:Le,compartment:e}),e}function O(e){return e.split(";").reduce((e,t)=>{const[n,...a]=t.trim().split(/\s+/g);return n&&!Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=a.includes("'none'")?[]:a),e},{})}function w(e,t,n=document.location){e=e.toLowerCase(),t=t.toLowerCase();const a=new URL(t),r=/^(?:(?<scheme>[a-z][a-z0-9+.-]*):\/\/)?(?<host>\[[0-9A-F:.]{2,}\]|(?:[^'\/?#:]|%[0-9A-F]{2})+)(?::(?<port>[^\/?]*))?(?<path>[^?#]*)?$/i;if("*"===e)return!["blob:","data:","filesystem:"].includes(a.protocol);if(e.match(/^[a-z][a-z0-9+.-]*:$/i))return a.protocol===e;if(e.match(r)){const{scheme:t,host:o,port:i,path:l}=e.match(r).groups;if(!a.hostname)return!1;const s=a.protocol.replace(":",""),c=a.hostname,d=a.port,u=a.pathname,m=Oe(u);if(t&&s!==t)return!1;if(!t){const e=n.protocol.replace(":","");if("http"===e&&"http"!==s&&"https"!==s||"http"!==e&&s!==e)return!1}if(o.startsWith("*")){if(!c.endsWith(o.slice(1)))return!1;}else if(c!==o)return!1;if(/^[\d.]+$/.test(o)&&"127.0.0.1"!==o||/^\[.*\]$/.test(o))return!1;if(!i){if(!["",{ftp:21,http:80,https:443,ws:80,wss:443}[s]].includes(d))return!1}else if("*"!==i&&d!==i)return!1;if(l){const e=!l.endsWith("/"),t=Oe(l);if(t.length>m.length)return!1;for(let e of t){e=decodeURIComponent(e);const t=decodeURIComponent(m[0]);if(t!==e)return!1;m.shift()}if(e&&0<m.length)return!1}return!0}if("'self'"===e){const{protocol:e,hostname:t,port:r}=n;return a.protocol===e&&a.hostname===t&&a.port===r}return!1}function R(){return window.document.createElement("web-sandbox")}const x=e=>{if("string"==typeof e&&["","module","application/javascript","application/ecmascript","text/javascript","text/ecmascript"].includes(e.trim().toLowerCase()))return!0;let t=window.WEBSANDBOX_PREVENT_SCRIPT_TYPE;if(t||(t=window.WEBSANDBOX_PREVENT_SCRIPT_TYPE=new Map),t.has(e))return t.get(e);t.set(e,!1);const n=document.createElement("script");n.setAttribute("type",e),n.textContent=`${"WEBSANDBOX_PREVENT_SCRIPT_TYPE"}.set(${JSON.stringify(e)}, true)`,document.head.appendChild(n);const a=t.get(e);return document.head.removeChild(n),a};var I=({parent:e})=>{let t;const n=(e,t)=>t.reduce((t,n)=>(t[n]=e[n],t),{});return{...n(Object,["assign","create","defineProperties","defineProperty","entries","freeze","fromEntries","getOwnPropertyDescriptor","getOwnPropertyDescriptors","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","is","isExtensible","isFrozen","isSealed","keys","preventExtensions","seal","setPrototypeOf","values"]),...n(Reflect,["apply","construct","deleteProperty","get","has","ownKeys","set"]),from:Array.from,isArray(e){return Array.isArray(e)},isBoolean(e){return"boolean"==typeof e},isNull(e){return null===e},isNumber(e){return"number"==typeof e},isString(e){return"string"==typeof e},isObject(e){return"object"==typeof e&&null!==e},isFunction(e){return"function"==typeof e},hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)},toString(e){return Object.prototype.toString.call(e)},inherits(e,t){const{has:n,get:a,ownKeys:r,set:o,deleteProperty:i,getOwnPropertyDescriptor:l}=Reflect;return new Proxy(e,{get(e,r,o){const i=n(e,r)?[e,r,o]:[t,r];return a(...i)},has(e,a){return n(e,a)||n(t,a)},ownKeys(e){return new Set(...r(e),...r(t))},set(e,a,r,i){const l=n(e,a)?[e,a,r,i]:[t,a,r];return o(...l)},deleteProperty(e,a){return i(n(e,a)?e:t,a)},getOwnPropertyDescriptor(e,a){return l(n(e,a)?e:t,a)}})},mixin(e,t){const{defineProperty:n,getOwnPropertyDescriptor:a,ownKeys:r}=Reflect;r(t).forEach(r=>{const o=a(t,r);n(e,r,o)})},queueMicrotask:"function"==typeof e.queueMicrotask?e.queueMicrotask.bind(e):n=>(t||(t=Promise.resolve())).then(n).catch(t=>e.setTimeout(()=>{throw t},0)),Events:class{constructor(){this.eventTarget=new e.EventTarget}add(e,t){this.eventTarget.addEventListener(e,({detail:e})=>{t(e)})}dispatch(t,n){this.eventTarget.dispatchEvent(new e.CustomEvent(t,{detail:n}))}}}},P=e=>{const t=e.compartment;return((e,n)=>n.debug?e(n):t.evaluate(e.toString())(n))(I,e)},D=({compartment:e,csp:t,debug:n,documentView:a,namespace:r,parent:o,permissions:i,title:l,top:s,windowView:c},{apply:d,construct:u,defineProperty:m,getPrototypeOf:p,isFunction:f,isObject:b,toString:g})=>{const E={};E.bridge=E,E.title=l,E.namespace=r,E.permissions=i,E.compartment=e,E.global=e.global,E.top=s,E.parent=o,E.debug=n,E.windowView=c,E.documentView=a,E.csp=t,E.classRegistry=new Map;let h=null;return E.getCurrentNativeObject=function(){return h},E.setCurrentNativeObject=function(e){h=e},E.SandboxSecurityError=class extends TypeError{constructor(){super(...arguments),this.name="WebSandboxSecurityError"}},E.toNativeObject=function(e){const t=E.toNativeObject.cache.get(e);return t?t:e},E.toNativeObject.cache=new WeakMap,E.toVirtualObject=function(e){if(E.toVirtualObject.cache.has(e))return E.toVirtualObject.cache.get(e);let t;if(e===E.windowView)t=E.classRegistry.get("Window");else if(e===E.documentView)t=E.classRegistry.get("HTMLDocument");else{const n=p(e);if(n){const a=n.constructor,r=a&&a.name||e[Symbol.toStringTag];t=E.classRegistry.get(r)}}if(!t||[E.parent,E.parent.document].includes(e)||e.isConnected&&e instanceof E.parent.Node&&E.parent.document.documentElement.contains(e))throw new E.SandboxSecurityError(`Forbidden: ${g(e)}`);E.setCurrentNativeObject(e);const n=u(t,[]);return E.setCurrentNativeObject(null),E.bindObject(n,e),n},E.toVirtualObject.cache=new WeakMap,E.toLiveVirtuaObject=(e)=>new Proxy(e,["getPrototypeOf","setPrototypeOf","isExtensible","preventExtensions","getOwnPropertyDescriptor","defineProperty","has","get","set","deleteProperty","ownKeys"].reduce((e,t)=>(e[t]=(...e)=>E.toVirtualAny(Reflect[t](...e.map(e=>E.toNativeAny(e)))),e),{})),E.bindObject=function(e,t){E.toNativeObject.cache.set(e,t),E.toVirtualObject.cache.set(t,e)},E.toNativeFunction=function(e){if(E.toNativeFunction.cache.has(e))return E.toNativeFunction.cache.get(e);const t=e=>e.map(e=>E.toVirtualAny(e)),n=function(...n){const a=this,r=a?E.toVirtualObject(a):void 0,o=t(n),i=d(e,r,o);return E.toNativeAny(i)};return m(n,"name",{value:e.name,configurable:!0}),E.toNativeFunction.cache.set(e,n),n},E.toNativeFunction.cache=new WeakMap,E.toVirtualFunction=function(e){if(E.toVirtualFunction.cache.has(e))return E.toVirtualFunction.cache.get(e);const t=e=>e.map(e=>E.toNativeAny(e)),n=function(...n){const a=this,r=a?E.toNativeObject(a):void 0,o=t(n),i=d(e,r,o);return E.toVirtualAny(i)};return m(n,"name",{value:e.name,configurable:!0}),E.toVirtualFunction.cache.set(e,n),n},E.toVirtualFunction.cache=new WeakMap,E.toVirtualAny=function(e){return b(e)?E.toVirtualObject(e):f(e)?E.toVirtualFunction(e):e},E.toNativeAny=function(e){return b(e)?E.toNativeObject(e):f(e)?E.toNativeFunction(e):e},E},H=({bindObject:e,bridge:t,classRegistry:n,compartment:a,csp:r,debug:o,documentView:i,getCurrentNativeObject:l,global:s,parent:c,permissions:d,SandboxSecurityError:u,setCurrentNativeObject:m,toLiveVirtuaObject:p,toNativeAny:f,toNativeObject:b,top:g,toVirtualAny:E,windowView:h},{apply:S,construct:y,create:v,CSPValidation:C,defineProperties:T,defineProperty:N,entries:A,Events:M,from:L,getOwnPropertyDescriptor:O,getPrototypeOf:w,hasOwnProperty:R,inherits:x,isArray:I,isFunction:P,isJavaScriptType:D,isObject:H,keys:k,ownKeys:V,queueMicrotask:W,Sanitizer:j,setPrototypeOf:F,utils:_})=>{const U={},B={Window:h.constructor,Document:i.constructor};U.prefix=`${h.localName}.`,U.scriptType=`${U.prefix}script`,U.elementDefined=`${U.prefix}defined`,U.symbols={initialize:Symbol("initialize"),connectedCallback:Symbol("connectedCallback"),disconnectedCallback:Symbol("disconnectedCallback"),attributeChangedCallback:Symbol("attributeChangedCallback")},U.timeoutList=[],U.intervalList=[],U.animationFrameList=[];const G=new C(r);U.cspValidation=(e,t,n)=>{const{valid:a,message:r}=G.validity(e,t);if(!a)if("warn"===n)U.console.error(new u(r));else if("error"===n)throw new u(r);return a},U.console=A(c.console).reduce((e,[t,n])=>(e[t]=o?n:function(){U.callAndWrapError(n,this,arguments)},e),{});let z=null;return U.getCurrentScript=()=>z,U.setCurrentScript=e=>{z=e},U.customElements=new Map,U.events=new M,U.toVirtualNodeCreater=(e,t,n)=>function(){return U.callAndWrapError(()=>{const a=e=>[...new Set(e)],r=b(this),o=L(arguments).map(e=>f(e)),i=a(t(o,r)),l=a(n(o,r)),s=r[e](...o);return U.events.dispatch("MutationEvent",{addedNodes:i,removedNodes:l}),E(s)})},U.runScript=({src:e,textContent:t,element:n=null,csp:r=!0})=>{const o=g.fetch,i=s.Error;if(r&&e&&!U.cspValidation("script-src",e,"warn"))return Promise.reject();const l=e=>{U.setCurrentScript(n);try{a.evaluate(e)}catch(e){W(()=>{throw e})}U.setCurrentScript(null)};return e?o(e,{credentials:"same-origin"}).then(t=>{if(!t.ok)throw i([t.status,t.statusText,e].join(", "));const n=t.headers.get("content-type");if(!n||!/^(text|application)\/(x-)?javascript(;|$)/.test(n))throw i(n);return t.text().then(t=>{const n=/(\/\/# sourceURL=)((https?:\/\/)?([\w-])+\.{1}([a-zA-Z]{2,63})([/\w-]*)*\/?\??([^#\n\r]*)?)/;n.test(t)?t=t.replace(n,(t,n,a)=>`${n}${g.URL(a,e).href}`):t+=`\n//# sourceURL=${e}`,l(t)})}):(t&&l(t),Promise.resolve())},U.sanitizer=new j({...["allowElements","blockElements","dropElements","allowAttributes","dropAttributes"].reduce((e,t)=>(e[t]=d[t],e),{}),uponSanitizeElement(e,t){"script"===t.tagName&&D(e.type)?e.setAttribute("type",U.scriptType):c.customElements.get(t.tagName)&&e.parentNode.removeChild()}}),U.call=e=>o?e(t,_):a.evaluate(e.toString())(t,_),U.callAndWrapError=(e,t,n=[])=>{try{return S(e,t,n)}catch(e){if(H(e)&&e instanceof Object)throw e;throw E(e)}},U.configToMap=e=>{const t=e=>{const t=new Map,n=new Set(["arguments","caller","length","name","prototype"]),a=new Set(["constructor"]),r=(e,t)=>[...k(e).filter(e=>!n.has(e)),...k(t).filter(e=>!a.has(e))];return e.forEach(e=>{const n=e.name||e,a=e.value,o=c[n]||{},i=o.prototype||{};I(a)?t.set(n,new Set(a)):t.set(n,new Set(r(o,i)))}),t};return{allowInterfaces:t(e.allowInterfaces),blockInterfaces:t(e.blockInterfaces)}},U.createVirtualClass=(t,n={},r)=>{const o=c[t],i=O(n,U.symbols.initialize),s=a.evaluate(`(function ${t}(){return constructor.call(this,...arguments)})`,{constructor(){let t=this,n=l();if(n)e(t,n),r&&y(r,arguments,s);else{const a=L(arguments).map(e=>f(e));if(!(this instanceof s))return n=o(...a),E(n);n=y(o,a),H(n)&&e(t,n)}return i&&(m(n),t=i.value.call(t,...arguments)),t}}),d={constructor:{configurable:!0,value:s,writable:!0},[Symbol.toStringTag]:{configurable:!0,value:o.prototype&&o.prototype[Symbol.toStringTag]||t},...V(n).reduce((e,t)=>{const a=O(n,t);return e[t]=a,e},{})};return r?(F(s,r),s.prototype=v(r.prototype,d)):T(s.prototype,d),N(s,"toString",{configurable:!0,value(){return`function ${t}() { [virtual code] }`},writable:!0}),s},U.interfaceGenerator=(e,t)=>{const a=U.configToMap(d),r=(a,o)=>{if(s[a])return s[a];if(!o.has(a))throw new u(`"${a}" is not in the allowed list`);if(n.has(a))return n.get(a);const i=c[a],d=B[a]||i;if(!H(i)&&!P(i))return i;const m=w(i),f=m.name;f&&!n.get(f)&&r(f,o);const b=e[a]||{},g=t.includes(a);g&&(b[U.symbols.initialize]=function(){return x(this,p(l(),!0))});const E=n.get(m.name),h=U.createVirtualClass(a,b,E);return U.importPropertys(h,d,[...o.get(a).values()]),n.set(a,h),h};return[...a.allowInterfaces.keys()].reduce((e,t)=>{const n=r(t,a.allowInterfaces);return n&&(e[t]=n),e},{})},U.importPropertys=(e,t,n)=>{const a=(e,t)=>{const n=O(e,t);if(!n){const n=w(e);return n?a(n,t):void 0}return n},r=(e,t,n)=>{if(!R(e,n)){const r=a(t,n);r&&(V(r).forEach(e=>{const t=r[e];r[e]=P(t)?function(){return U.callAndWrapError(t,this,arguments)}:t,r[e]=E(r[e])}),N(e,n,r))}};n.forEach(n=>{r(e,t,n),P(t)&&t.prototype&&r(e.prototype,t.prototype,n)})},U},k=(e,t)=>{const n=e.compartment,a=(e,a)=>a.debug?e(a,t):n.evaluate(e.toString())(a,t),r=a(D,e);return t.assign(r,a(H,r)),r};const V=a(r),W=a(function(){const{getPrototypeOf:e}=Object,{apply:t}=Reflect,n=e=>(n,...a)=>t(e,n,a),a=n(Map.prototype.get),r=n(Set.prototype.has),o=new Map([["EvalError",EvalError],["RangeError",RangeError],["ReferenceError",ReferenceError],["SyntaxError",SyntaxError],["TypeError",TypeError],["URIError",URIError]]),i=new Set([EvalError.prototype,RangeError.prototype,ReferenceError.prototype,SyntaxError.prototype,TypeError.prototype,URIError.prototype,Error.prototype]);return function(n,l){try{return t(n,void 0,l)}catch(t){if(Object(t)!==t)throw t;if(r(i,e(t)))throw t;let n,l,s;try{n=`${t.name}`,l=`${t.message}`,s=`${t.stack||l}`}catch(e){throw new Error("unknown error")}const c=a(o,n)||Error;try{throw new c(l)}catch(e){throw e.stack=s,e}}}}),{assign:j,create:F,freeze:_,defineProperties:U,getOwnPropertyDescriptor:B,getOwnPropertyDescriptors:G,getOwnPropertyNames:z,getPrototypeOf:K,setPrototypeOf:q}=Object,{apply:X,ownKeys:Y}=Reflect,Q=e=>(t,...n)=>X(e,t,n),J=Q(Object.prototype.hasOwnProperty),Z=Q(Array.prototype.filter),$=Q(Array.prototype.pop),ee=Q(Array.prototype.join),te=Q(Array.prototype.concat),ne=Q(RegExp.prototype.test),ae=Q(String.prototype.includes),re=["Infinity","NaN","undefined"],oe=["isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","Array","ArrayBuffer","Boolean","DataView","EvalError","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Map","Number","Object","RangeError","ReferenceError","Set","String","Symbol","SyntaxError","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","URIError","WeakMap","WeakSet","JSON","Math","Reflect","escape","unescape"],ie=["Date","Error","Promise","Proxy","RegExp","Intl"],le="'use strict'; this",se=`(0, eval)("'use strict'; this")`,ce=()=>{const e=c(),t=s();if(!e&&!t||e&&t)throw new Error("unexpected platform, unable to create Realm");return e||t},de=a(i),ue=a(l),me=/^[a-zA-Z_$][\w$]*$/,pe=new Set(["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","new","return","super","switch","this","throw","try","typeof","var","void","while","with","yield","let","static","enum","implements","package","protected","interface","private","public","await","null","true","false","this","arguments"]),fe=a(function(e,t,n={},a=!1){const{unsafeGlobal:r,unsafeEval:o}=e,{freeze:i,getOwnPropertyDescriptor:l}=Object,{get:s,set:c}=Reflect,d=new Proxy(i({}),{get(e,t){throw new TypeError(`unexpected scope handler trap called: ${t+""}`)}});return{__proto__:d,useUnsafeEvaluator:!1,get(e,a){return"symbol"==typeof a?void 0:"eval"===a&&!0===this.useUnsafeEvaluator?(this.useUnsafeEvaluator=!1,o):a in n?s(n,a,t):s(t,a)},set(e,a,r){if(a in n){const e=l(n,a);return"value"in e?c(n,a,r):c(n,a,r,t)}return c(t,a,r)},has(e,o){return!!a||!!("eval"===o||o in n||o in t||o in r)},getPrototypeOf(){return null}}}),be=a(function(e,t){const{callAndWrapError:n}=e,{defineProperties:a}=Object,r={eval(){return n(t,arguments)}}.eval;return a(r,{toString:{value:()=>`function ${"eval"}() { [shim code] }`,writable:!1,enumerable:!1,configurable:!0}}),r}),ge=a(function(e,t){const{callAndWrapError:n,unsafeFunction:a}=e,{defineProperties:r}=Object,o=function(){return n(t,arguments)};return r(o,{prototype:{value:a.prototype},toString:{value:()=>"function Function() { [shim code] }",writable:!1,enumerable:!1,configurable:!0}}),o}),Ee=a(function(e,t){const{create:n,getOwnPropertyDescriptors:a}=Object,{apply:r}=Reflect,o=(e=>(t,...n)=>r(e,t,n))(Array.prototype.reduce);return e={src:`${e.src}`,endowments:n(null,a(e.endowments))},e=o(t,(e,t)=>t.rewrite?t.rewrite(e):e,e),e={src:`${e.src}`,endowments:n(null,a(e.endowments))},e}),he=/(?:<!--|-->)/,Se=/\bimport\s*(?:\(|\/[/*])/,ye=/\beval\s*(?:\(|\/[/*])/,ve={rewrite(e){return g(e.src),e}},Ce=new WeakMap,Te={initRootRealm:function(e,t,n){const{shims:a,transforms:r,sloppyGlobals:o,configurableGlobals:i}=n,l=te(e.allShims,a),s=u(l,i),{unsafeEval:c}=s,d=c(V)(s,Te);s.sharedGlobalDescs.Realm={value:d,writable:!0,configurable:!0};const m=M(s,r,o),{safeEvalWhichTakesEndowments:p}=m;for(const a of l)p(a);N(t,m)},initCompartment:function(e,t,n={}){const{transforms:a,sloppyGlobals:r}=n,o=M(e,a,r);N(t,o)},getRealmGlobal:function(e){const{safeGlobal:t}=T(e);return t},realmEvaluate:function(e,t,n={},a={}){const{safeEvalWhichTakesEndowments:r}=T(e);return r(t,n,a)}},Ne=function(){const e=eval,t=e(le);return i(),l(),d(t)}(),Ae=r(Ne,Te);var Me=({rootRealm:e,compartment:t})=>{const{defineProperty:n,getOwnPropertyDescriptor:a,ownKeys:r}=Reflect,o=(e,t)=>{const r=a(e,t);if(r&&r.configurable){if(r.hasOwnProperty("value")){const a=r.value;delete r.value,delete r.writable,r.get=()=>a,r.set=function(a){if(this!==e)n(this,t,{configurable:!0,enumerable:!0,value:a,writable:!0});else throw TypeError(`Cannot assign to read only property '${t}' of object '#<${e}>'`)}}r.configurable=!1,n(e,t,r)}};delete t.global.Realm,r(e.global).map(t=>e.global[t]).filter(e=>e&&"object"==typeof e||"function"==typeof e).forEach(e=>{r(e).forEach(t=>{o(e,t)}),e.prototype&&r(e.prototype).forEach(t=>{o(e.prototype,t)})})};let Le;const Oe=e=>e.replace(/^\/|\/$/g,"").split("/"),we=["connect-src","script-src"];class Re{constructor(e){this.policy={...("string"==typeof e?O(e):e)}}validity(e,t){let n=!0,a="",r=this.policy[e];return(!r&&we.includes(e)&&(e="default-src",r=this.policy[e]||["*"]),!r)?{valid:n,message:a}:(n="sandbox"===e?r.includes(t):r.length&&r.some(e=>w(e,t)),n||(a=`Refused: ${JSON.stringify(t)}: Because it violates the following Content Security Policy directive: "${e} ${r.join(" ")}"`),{valid:n,message:a})}}var xe=["Array","AudioParamMap","CSSKeyframesRule","CSSNumericArray","CSSRuleList","CSSStyleDeclaration","CSSTransformValue","CSSUnparsedValue","DataTransferItemList","DOMRectList","DOMStringList","DOMTokenList","EventCounts","FileList","FormData","Headers","HTMLAllCollection","HTMLCollection","HTMLFormControlsCollection","HTMLFormElement","HTMLOptionsCollection","HTMLSelectElement","KeyboardLayoutMap","MediaKeyStatusMap","MediaList","MIDIInputMap","MIDIOutputMap","MimeTypeArray","NamedNodeMap","NodeList","Object","Plugin","PluginArray","Promise","RadioNodeList","RTCStatsReport","SourceBufferList","StylePropertyMap","StylePropertyMapReadOnly","StyleSheetList","SVGLengthList","SVGNumberList","SVGPointList","SVGStringList","SVGTransformList","TextTrackCueList","TextTrackList","TouchList","XRAnchorSet","XRInputSourceArray"];const Ie=(e,t=/^(on)[\w]+/)=>Object.keys("string"==typeof e?window[e].prototype:e).filter(e=>t.test(e));var Pe={allowInterfaces:["AggregateError","AnalyserNode","Animation","AnimationEffect","AnimationEvent","AnimationPlaybackEvent","AnimationTimeline","atob","Atomics","Attr","Audio","AudioBuffer","AudioBufferSourceNode","AudioContext","AudioDestinationNode","AudioListener","AudioNode","AudioParam","AudioParamMap","AudioProcessingEvent","AudioScheduledSourceNode","BaseAudioContext","BeforeUnloadEvent","Blob","BlobEvent","blur","btoa","ByteLengthQueuingStrategy","cancelAnimationFrame","CanvasCaptureMediaStreamTrack","CanvasGradient","CanvasPattern","CanvasRenderingContext2D","CDATASection","ChannelMergerNode","ChannelSplitterNode","CharacterData","clearInterval","clearTimeout","Clipboard","ClipboardEvent","ClipboardItem","close","closed","Comment","CompositionEvent","CompressionStream","console","ConstantSourceNode","ConvolverNode","CountQueuingStrategy","createImageBitmap","CSS","CSS2Properties","CSSAnimation","CSSConditionRule","CSSFontFaceRule","CSSGroupingRule","CSSImageValue","CSSImportRule","CSSKeyframeRule","CSSKeyframesRule","CSSKeywordValue","CSSMathInvert","CSSMathMax","CSSMathMin","CSSMathNegate","CSSMathProduct","CSSMathSum","CSSMathValue","CSSMatrixComponent","CSSMediaRule","CSSNamespaceRule","CSSNumericArray","CSSNumericValue","CSSPageRule","CSSPerspective","CSSPositionValue","CSSPropertyRule","CSSRotate","CSSRule","CSSRuleList","CSSScale","CSSSkew","CSSSkewX","CSSSkewY","CSSStyleDeclaration","CSSStyleRule","CSSStyleSheet","CSSStyleValue","CSSSupportsRule","CSSTransformComponent","CSSTransformValue","CSSTransition","CSSTranslate","CSSUnitValue","CSSUnparsedValue","CSSVariableReferenceValue","CustomElementRegistry","customElements","CustomEvent","DataTransfer","DataTransferItem","DataTransferItemList","DelayNode","DeviceMotionEvent","DeviceMotionEventAcceleration","DeviceMotionEventRotationRate","DeviceOrientationEvent","devicePixelRatio",{name:"Document",value:["activeElement","adoptNode","body","characterSet","childElementCount","children","contentType","createAttribute","createAttributeNS","createCDATASection","createComment","createDocumentFragment","createElement","createElementNS","createEvent","createNodeIterator","createProcessingInstruction","createTextNode","createTreeWalker","defaultView","documentElement","documentURI","domain","firstElementChild","getAnimations","getElementById","getElementsByClassName","getElementsByName","getElementsByTagName","getElementsByTagNameNS","head","hidden","importNode","lastElementChild",...Ie("Document"),"querySelector","querySelectorAll","readyState","styleSheets","title","URL","visibilityState"]},{name:"DocumentFragment",value:["append","childElementCount","children","firstElementChild","getElementById","lastElementChild","prepend","querySelector","querySelectorAll","replaceChildren"]},"DocumentTimeline","DOMError","DOMException","DOMMatrix","DOMMatrixReadOnly","DOMPoint","DOMPointReadOnly","DOMQuad","DOMRect","DOMRectList","DOMRectReadOnly","DOMStringList","DOMStringMap","DOMTokenList","DragEvent","DynamicsCompressorNode",{name:"Element",value:["after","animate","append","attachShadow","attributes","attributeStyleMap","before","childElementCount","children","classList","className","clientHeight","clientLeft","clientTop","clientWidth","closest","computedStyleMap","firstElementChild","getAnimations","getAttribute","getAttributeNames","getAttributeNode","getAttributeNodeNS","getAttributeNS","getBoundingClientRect","getClientRects","getElementsByClassName","getElementsByTagName","getElementsByTagNameNS","hasAttribute","hasAttributeNS","hasAttributes","id","innerHTML","insertAdjacentElement","insertAdjacentHTML","insertAdjacentText","lastElementChild","localName","matches","namespaceURI","nextElementSibling","outerHTML","part","prefix","previousElementSibling","querySelector","querySelectorAll","remove","removeAttribute","removeAttributeNode","removeAttributeNS","scroll","scrollBy","scrollHeight","scrollIntoView","scrollLeft","scrollTo","scrollTop","scrollWidth","setAttribute","setAttributeNode","setAttributeNodeNS","setAttributeNS","shadowRoot","tagName","toggleAttribute",...Ie("Element",/^(aria|on)[\w]+/)]},"ElementInternals","ErrorEvent",{name:"Event",value:["bubbles","cancelable","currentTarget","defaultPrevented","eventPhase","initEvent","preventDefault","stopImmediatePropagation","stopPropagation","target","timeStamp","type"]},{name:"EventTarget",value:["addEventListener","dispatchEvent","removeEventListener"]},"fetch","focus","FocusEvent","FontFace","FontFaceSetLoadEvent","GainNode","getComputedStyle","HashChangeEvent","HTMLAllCollection","HTMLAnchorElement","HTMLAreaElement","HTMLAudioElement","HTMLQuoteElement",{name:"HTMLBodyElement",value:Ie("HTMLBodyElement")},"HTMLBRElement","HTMLButtonElement","HTMLCanvasElement","HTMLCollection","HTMLTableCaptionElement","HTMLTableColElement","HTMLDataElement","HTMLDataListElement","HTMLDocument",{name:"HTMLElement",value:["accessKey","autofocus","blur","click","dataset","dir","draggable","focus","hidden","innerText","lang","offsetHeight","offsetLeft","offsetParent","offsetTop","offsetWidth",...Ie("HTMLElement"),"spellcheck","style","tabIndex","title"]},"HTMLModElement","HTMLDetailsElement","HTMLDialogElement","HTMLDivElement","HTMLDListElement","HTMLFieldSetElement","HTMLFormElement","HTMLHeadingElement","HTMLHeadElement","HTMLHRElement","HTMLHtmlElement","HTMLImageElement","HTMLInputElement","HTMLLabelElement","HTMLLegendElement","HTMLLIElement","HTMLLinkElement","HTMLMapElement","HTMLMediaElement","HTMLMeterElement","HTMLMenuElement","HTMLOListElement","HTMLOptGroupElement","HTMLOptionElement","HTMLOptionsCollection","HTMLOutputElement","HTMLParagraphElement","HTMLPictureElement","HTMLPreElement","HTMLProgressElement","HTMLScriptElement","HTMLSelectElement",{name:"HTMLSlotElement",value:[]},"HTMLSourceElement","HTMLSpanElement","HTMLStyleElement","HTMLTableElement","HTMLTableSectionElement","HTMLTableCellElement","HTMLTemplateElement","HTMLTextAreaElement","HTMLTimeElement","HTMLTitleElement","HTMLTableRowElement","HTMLTrackElement","HTMLUListElement","HTMLUnknownElement","HTMLVideoElement","IIRFilterNode","Image","ImageBitmap","ImageBitmapRenderingContext","ImageCapture","ImageData","innerHeight","innerWidth","InputEvent","Keyboard","KeyboardEvent","KeyboardLayoutMap","KeyframeEffect",{name:"localStorage",value:[]},"Location","location","matchMedia","MediaCapabilities","MediaDeviceInfo","MediaDevices","MediaElementAudioSourceNode","MediaError","MediaKeyMessageEvent","MediaKeys","MediaKeySession","MediaKeyStatusMap","MediaKeySystemAccess","MediaList","MediaMetadata","MediaQueryList","MediaQueryListEvent","MediaRecorder","MediaSession","MediaSource","MediaStream","MediaStreamAudioDestinationNode","MediaStreamAudioSourceNode","MediaStreamTrack","MediaStreamTrackEvent","menubar","MessageChannel","MessageEvent","MessagePort",{name:"MouseEvent",value:["altKey","button","clientX","clientY","ctrlKey","metaKey","movementX","movementY","offsetX","offsetY","pageX","pageY","relatedTarget","shiftKey","x","y"]},"MutationObserver","MutationRecord","name","NamedNodeMap","NavigationPreloadManager",{name:"Navigator",value:["language","languages","userAgent"]},"navigator",{name:"Node",value:["appendChild","ATTRIBUTE_NODE","baseURI","CDATA_SECTION_NODE","childNodes","cloneNode","COMMENT_NODE","contains","DOCUMENT_FRAGMENT_NODE","DOCUMENT_NODE","DOCUMENT_POSITION_CONTAINED_BY","DOCUMENT_POSITION_CONTAINS","DOCUMENT_POSITION_DISCONNECTED","DOCUMENT_POSITION_FOLLOWING","DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC","DOCUMENT_POSITION_PRECEDING","DOCUMENT_TYPE_NODE","ELEMENT_NODE","ENTITY_NODE","ENTITY_REFERENCE_NODE","firstChild","hasChildNodes","insertBefore","isConnected","isEqualNode","lastChild","nextSibling","nodeName","nodeType","nodeValue","normalize","NOTATION_NODE","ownerDocument","parentNode","previousSibling","PROCESSING_INSTRUCTION_NODE","removeChild","replaceChild","textContent","TEXT_NODE"]},"NodeFilter","NodeIterator","NodeList","Notification","OfflineAudioCompletionEvent","OfflineAudioContext","offscreenBuffering","OffscreenCanvas","OffscreenCanvasRenderingContext2D",...Ie(window),"outerHeight","outerWidth","OverconstrainedError","PageTransitionEvent","pageXOffset","pageYOffset","Path2D","RadioNodeList","requestAnimationFrame","requestIdleCallback","ResizeObserver","ResizeObserverEntry","ResizeObserverSize","setInterval","setTimeout",{name:"ShadowRoot",value:["activeElement","delegatesFocus","getAnimations","host","innerHTML","mode","styleSheets"]},"SharedArrayBuffer","SourceBuffer","SourceBufferList","speechSynthesis","SpeechSynthesisErrorEvent","SpeechSynthesisEvent","SpeechSynthesisUtterance",{name:"Storage",value:["clear","getItem","key","length","removeItem","setItem"]},"StorageEvent","StorageManager","styleMedia","StylePropertyMap","StylePropertyMapReadOnly","StyleSheet","StyleSheetList","SubmitEvent",{name:"Text",value:["wholeText"]},"TextDecoder","TextDecoderStream","TextEncoder","TextEncoderStream","TextEvent","TextMetrics","TextTrack","TextTrackCue","TextTrackCueList","TextTrackList","Touch","TouchEvent","TouchList","TrackEvent","TransformStream","TransitionEvent","TreeWalker","TrustedHTML","TrustedScript","TrustedScriptURL","TrustedTypePolicy","TrustedTypePolicyFactory","trustedTypes",{name:"UIEvent",value:["detail"]},"URL","URLSearchParams","VideoPlaybackQuality","WebGL2RenderingContext","WebGLActiveInfo","WebGLBuffer","WebGLContextEvent","WebGLFramebuffer","WebGLProgram","WebGLQuery","WebGLRenderbuffer","WebGLRenderingContext","WebGLSampler","WebGLShader","WebGLShaderPrecisionFormat","WebGLSync","WebGLTexture","WebGLTransformFeedback","WebGLUniformLocation","WebGLVertexArrayObject","WheelEvent",{name:"Window",value:[]},"WritableStream","WritableStreamDefaultWriter","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],blockInterfaces:[],allowElements:[],blockElements:[],dropElements:[],allowAttributes:[],dropAttributes:[]};const De=Object.seal(/^data-[\-\w.\u00B7-\uFFFF]/),He=Object.seal(/^aria-[\-\w]+$/),ke=Object.seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ve=Object.seal(/^(?:\w+script|data):/i),We=Object.seal(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),{Node:je,NodeFilter:Fe,Text:_e,Comment:Ue,NamedNodeMap:Be,DocumentFragment:Ge,document:ze}=window,Ke=Symbol("executeHook"),qe=Symbol("sanitizeElements"),Xe=Symbol("sanitizeAttributes"),Ye=Symbol("sanitizeShadowDOM"),Qe=Symbol("sanitize"),Je=["base","embed","iframe","meta","noscript","object","param","frame","frameset","noframes"],Ze=["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"],$e=["audio","video","img","source","image","track"],et=["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"],tt=ze.createElement("form"),nt=e=>{try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=""}catch(t){e.remove()}}},at=function(e,t){if(t.removeAttribute(e),"is"===e)try{t.setAttribute(e,"")}catch(e){}},rt=e=>{const t=e.match(/^[\r\n\t ]+/),n=t&&t[0],a=ze.implementation.createHTMLDocument(""),{body:r}=a;return r.innerHTML=e,e&&n&&a.body.insertBefore(ze.createTextNode(n),a.body.childNodes[0]||null),r},ot=e=>(e.ownerDocument||e).createNodeIterator(e,Fe.SHOW_ELEMENT|Fe.SHOW_COMMENT|Fe.SHOW_TEXT,()=>Fe.FILTER_ACCEPT,!1),it=e=>!(e instanceof _e||e instanceof Ue)&&!("string"==typeof e.nodeName&&"string"==typeof e.textContent&&"function"==typeof e.removeChild&&e.attributes instanceof Be&&"function"==typeof e.removeAttribute&&"function"==typeof e.setAttribute&&"string"==typeof e.namespaceURI&&"function"==typeof e.insertBefore),lt=e=>"object"==typeof je?e instanceof je:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName;class st{constructor(e={}){this.config=e}[Ke](e,t,n){const a=this.config[e];a&&a.call(this,t,n,this.config)}[qe](e){const{allowElements:t,dropElements:n}=this.config;if(this[Ke]("beforeSanitizeElements",e,null),it(e))return nt(e),!0;if(e.nodeName.match(/[\u0080-\uFFFF]/))return nt(e),!0;const a=e.nodeName.toLowerCase();if(this[Ke]("uponSanitizeElement",e,{tagName:a,allowElements:t}),"script"===a&&!e.type)return nt(e),!0;if(("svg"===a||"math"===a)&&0!==e.querySelectorAll("p, br, form, table, h1, h2, h3, h4, h5, h6").length)return nt(e),!0;if(!lt(e.firstElementChild)&&(!lt(e.content)||!lt(e.content.firstElementChild))&&/<[/\w]/g.test(e.innerHTML)&&/<[/\w]/g.test(e.textContent))return nt(e),!0;if(!this.isValidElement(a)){const t=!Je.includes(a)&&n&&!n.includes(a);if(t&&!Ze.includes(a)){const t=e.parentNode,n=e.childNodes,a=n.length;for(let r=a-1;0<=r;--r)t.insertBefore(n[r].cloneNode(!0),e.nextSibling)}return nt(e),!0}return("noscript"===a||"noembed"===a)&&/<\/no(script|embed)/i.test(e.innerHTML)?(nt(e),!0):(this[Ke]("afterSanitizeElements",e,null),!1)}isValidAttribute(e,t,n){const{allowAttributes:a,dropAttributes:r}=this.config,o=e.toLowerCase(),i=t.toLowerCase();if(("id"===i||"name"===i)&&(n in ze||n in tt))return!1;if(0===i.indexOf("on")||"script"===o&&"type"===i&&x(n))return!1;if(De.test(i));else if(He.test(i));else{if(r&&r.includes(i)||a&&a.length&&!a.includes(i))return!1;if(et.includes(i));else if(ke.test(n.replace(We,"")));else if(("src"===i||"xlink:href"===i||"href"===i)&&"script"!==o&&0===n.indexOf("data:")&&$e.includes(o));else if(!Ve.test(n.replace(We,"")));else if(!n);else return!1}return!0}isValidElement(e){const{allowElements:t,blockElements:n,dropElements:a}=this.config,r=e.toLowerCase();return!Je.includes(r)&&!(a&&a.includes(r)||n&&n.includes(r)||t&&t.length&&!t.includes(r))}[Xe](e){const{allowAttributes:t}=this.config,n=e.nodeName;let a,r,o,i;this[Ke]("beforeSanitizeAttributes",e,null);const{attributes:s}=e;if(s){const l={name:"",value:"",keep:!0,allowAttributes:t};for(i=s.length;i--;){a=s[i];const{name:t}=a;(r=a.value.trim(),o=t,l.name=o,l.value=r,l.keep=void 0,this[Ke]("uponSanitizeAttribute",e,l),r=l.value,!l.keep)&&(this.isValidAttribute(n,o,r)||at(t,e))}this[Ke]("afterSanitizeAttributes",e,null)}}[Ye](e){let t;const n=ot(e);for(this[Ke]("beforeSanitizeShadowDOM",e,null);t=n.nextNode();)(this[Ke]("uponSanitizeShadowNode",t,null),!this[qe](t))&&(t.content instanceof Ge&&this[Ye](t.content),this[Xe](t));this[Ke]("afterSanitizeShadowDOM",e,null)}[Qe](e,t){e=`${e}`;const n=rt(e);if(!n)return t?ze.createDocumentFragment():"";const a=ot(n);for(let n;n=a.nextNode();)this[qe](n)||(n.content instanceof Ge&&this[Ye](n.content),this[Xe](n));if(t){const e=n.ownerDocument.createDocumentFragment();if(n)for(;n.firstChild;)e.appendChild(n.firstChild);return e}const r=n.innerHTML;return r}sanitize(e){return this[Qe](e,!0)}sanitizeToString(e){return this[Qe](e)}}var ct=({animationFrameList:e,callAndWrapError:t,console:n,cspValidation:a,documentView:r,global:o,intervalList:i,namespace:l,parent:s,SandboxSecurityError:c,timeoutList:d,title:u,toNativeAny:m,toNativeFunction:p,toNativeObject:f,top:b,toVirtualAny:g,toVirtualObject:E},{defineProperties:h,has:S,isFunction:y,isString:v})=>{let C,T;const N=s,A=s.document,M=s.location,L=b.URL,O=e=>t(()=>new L(e,A.baseURI)),w=(e,n)=>{t(()=>{if(!a("sandbox","allow-top-navigation","error"))return;const t=!["href","assign","replace"].includes(e),r=new L(A.baseURI);if(t?S(r,e)&&(r[e]=n):r.href=O(n).href,["javascript:","blob:","data:","filesystem:"].includes(r.protocol))throw new c(`Forbidden: "${r.protocol}"`);a("navigate-to",r.href,"error")&&("reload"===e?M[e](n):["assign","replace"].includes(e)?M[e](r.href):M.href=r.href)})},R=e=>function(){return t(()=>{const t=Array.from(arguments).map(e=>m(e)),n=N[e](...t),a=g(n);return a})},x=R("fetch"),I={atob:R("atob"),btoa:R("btoa"),setTimeout(e,...n){if(v(e))throw new c(`The first parameter must be a function`);return d.push(t(()=>N.setTimeout(p(e),...n)))},clearTimeout(e){const n=d.indexOf(e);-1!==n&&(d.splice(n,1),t(()=>N.clearTimeout(e)))},setInterval(e,...n){if(v(e))throw new c(`The first parameter must be a function`);return i.push(t(()=>N.setInterval(p(e),...n)))},clearInterval(e){const n=i.indexOf(e);-1!==n&&(i.splice(n,1),t(()=>N.clearInterval(e)))},fetch(){const e=arguments[0],n=O(v(e)?e:e.url);return a("connect-src",n.href,"error")?x(...arguments).catch(e=>t(()=>{throw e})):Promise.reject()}};y(N.queueMicrotask)&&(I.queueMicrotask=R("queueMicrotask"));const P={console:n,get customElements(){return E(N.customElements)},get localStorage(){return E(N.localStorage)},name:l,get navigator(){return E(N.navigator)},get self(){return o},get window(){return o},get document(){return C||t(()=>{C=E(r);const e=A.createElement("html"),t=A.createElement("head"),n=A.createElement("title"),a=A.createElement("body");return n.textContent=u,t.appendChild(n),e.appendChild(t),e.appendChild(a),r.appendChild(e),C})},get location(){return T?T:(T=h(E(M),{...["hash","host","hostname","href","origin","password","pathname","port","protocol","search","username"].reduce((e,t)=>(e[t]={enumerable:!0,get(){return M[t]},set(e){w(t,e)}},e),{}),...["assign","reload","replace"].reduce((e,t)=>(e[t]={enumerable:!0,value(e){w(t,e)}},e),{}),...{toString:{enumerable:!0,value(){return this.href}}}}),T)},set location(e){this.location.href=e},close(){if(!o.closed){const{dispatchEvent:t,clearTimeout:n,clearInterval:a,cancelAnimationFrame:r,document:l,Event:s}=o;t(new s("beforeunload")),t(new s("pagehide")),t(new s("unload")),d.forEach(e=>n(e)),i.forEach(e=>a(e)),e.forEach(e=>r(e)),l.removeChild(l.documentElement),o.closed=!0}},getComputedStyle(e,n){return t(()=>{const t=f(e),a=N.getComputedStyle(t,n);return E(a)})},...I};return P};const dt={CustomElementRegistry:({bindObject:e,callAndWrapError:t,customElements:n,elementDefined:a,global:r,setCurrentNativeObject:o,toNativeObject:i},{create:l,construct:s,setPrototypeOf:c,inherits:d,isArray:u})=>{const m=new Map;return{define(e,t,a={}){if(!e.includes("-")||n.has(e))throw new TypeError(`Illegal constructor`);const o=t.observedAttributes;if(n.set(e,{constructor:t,observedAttributes:u(o)?[...o]:[],options:a}),m.has(e))for(let t;t=m.get(e).shift();)t();r.document.querySelectorAll(a.extends?`${a.extends}[is="${e}"]`:e).forEach(e=>{this.upgrade(e)})},get(e){const t=n.get(e);return t?t.constructor:void 0},upgrade(r){t(()=>{const t=r.getAttribute("is")||r.localName,u=n.get(t);if(u&&!(r instanceof u.constructor)){const t=i(r);o(t);const n=s(u.constructor,[]);if(o(null),c(r,d(n,l(u.constructor.prototype))),t.setAttribute(a,""),e(r,t),u.observedAttributes.length&&r.attributeChangedCallback)for(const e of u.observedAttributes){const t=r.getAttribute(e);t&&r.attributeChangedCallback(e,null,t)}t.isConnected&&r.connectedCallback&&r.connectedCallback()}})},whenDefined(e){return n.get(e)?Promise.resolve():new Promise((t)=>{m.has(e)||m.set(e,[]),m.get(e).push(t)})}}},Document:({callAndWrapError:e,getCurrentScript:t,global:n,parent:a,SandboxSecurityError:r,sanitizer:o,toNativeAny:i,toVirtualAny:l},{defineProperty:s,from:c,keys:d})=>{const u=new WeakMap,m=a.document,f=a.customElements,b=t=>e(()=>m[t]),g=t=>function(){return e(()=>{const e=c(arguments).map(e=>i(e)),n=m[t](...e),a=l(n);return a})},E=t=>function(...a){return e(()=>{const e={createElement:{name:a[0],options:a[1]},["createElementNS"]:{ns:a[0],name:a[1],options:a[2]}}[t];if(!o.isValidElement(e.name)||f.get(e.name))throw new r(`Forbidden: tag <${e.name} />`);const i=m[t](...a);e.options&&i.setAttribute("is",e.options.is);const s=l(i);return n.customElements.upgrade(s),s})},h=g("adoptNode"),S=g("createAttribute"),y=g("createAttributeNS"),v=g("createCDATASection"),C=g("createComment"),T=g("createDocumentFragment"),N=E("createElement"),A=E("createElementNS"),M=g("createEvent"),L=g("createNodeIterator"),O=g("createProcessingInstruction"),w=g("createTextNode"),R=g("createTreeWalker"),x=g("importNode"),I={adoptNode:h,get body(){return this.querySelector("body")},get characterSet(){return b("characterSet")},get contentType(){return b("contentType")},createAttribute:S,createAttributeNS:y,createCDATASection:v,createComment:C,createDocumentFragment:T,createElement:N,createElementNS:A,createEvent:M,createNodeIterator:L,createProcessingInstruction:O,createTextNode:w,createTreeWalker:R,get currentScript(){return t()},get defaultView(){return n},get documentElement(){return this.querySelector("html")},get documentURI(){return b("documentURI")},get domain(){return b("domain")},get head(){return this.querySelector("head")},get hidden(){return b("hidden")},importNode:x,get readyState(){return b("readyState")},get title(){return this.querySelector("title").textContent},set title(e){this.querySelector("title").textContent=e},get URL(){return b("URL")},get visibilityState(){return b("visibilityState")}};return d(a.Document.prototype).filter(e=>/^on[\w\W]+$/.test(e)).forEach(e=>{s(I,e,{enumerable:!0,configurable:!0,get(){const t=u.get(this);return t&&t[e]||null},set(t){const n=e.replace("on",""),a=this[e];u.has(this)||u.set(this,{}),a&&this.removeEventListener(n,a),this.addEventListener(n,t),u.get(this)[e]=t}})}),I},Element:({callAndWrapError:e,customElements:t,events:n,prefix:a,SandboxSecurityError:r,sanitizer:o,toNativeAny:i,toNativeObject:l,toVirtualAny:s,toVirtualNodeCreater:c,toVirtualObject:d,windowView:u},{from:m})=>{const p=(t,n)=>e(()=>l(t)[n]),f=(n,c)=>function(){return e(()=>{const[e,d]=c(arguments),u=m(arguments).map(e=>i(e)),p=l(this),f=p.getAttribute(e),b=p.nodeName;if(!o.isValidAttribute(b,e,d)||0===e.indexOf(a)||0===d.indexOf(a))throw new r(`Forbidden: attribute [${e}=${JSON.stringify(d)}]`);const g=p[n](...u),E=p.getAttribute("is")||p.localName,h=p.getAttribute(e);return t.get(E)&&t.get(E).observedAttributes.includes(e)&&this.attributeChangedCallback&&(null!==f||null!==h)&&this.attributeChangedCallback(e,f,h),s(g)})},b=e=>{const t=u.getBoundingClientRect();return e.x-=t.x,e.y-=t.y,e},g=(e,t)=>{n.dispatch("MutationEvent",{addedNodes:e,removedNodes:t})};return{get className(){return p(this,"className")},set className(e){this.setAttribute("class",e)},set innerHTML(t){e(()=>{const e=l(this),n=o.sanitize(t),a=m(e.childNodes),r=m(n.childNodes);for(;e.firstChild;)e.removeChild(e.firstChild);"template"===e.nodeName.toLowerCase()?e.content.appendChild(n):e.appendChild(n),g(r,a)})},get innerHTML(){return p(this,"innerHTML")},set outerHTML(t){e(()=>{const e=l(this),n=o.sanitize(t),a=m(n.childNodes);e.parentNode.replaceChild(n,e),g(a,[e])})},get outerHTML(){return p(this,"outerHTML")},insertAdjacentHTML(t,n){e(()=>{const e=l(this),a=o.sanitize(n),r=m(a.childNodes);switch(t.toLowerCase()){case"beforebegin":e.parentNode.insertBefore(a,e);break;case"afterbegin":e.insertBefore(a,e.firstChild);break;case"beforeend":e.appendChild(a);break;case"afterend":e.parentNode.insertBefore(a,e.nextElementSibling);break;default:throw new TypeError(`invalid parameter '${t}'`);}g(r,[])})},insertAdjacentElement:c("insertAdjacentElement",e=>[e[1]],e=>e[1].isConnected?[e[1]]:[]),before:c("before",e=>e,e=>e.filter(e=>e.isConnected)),append:c("append",e=>e,e=>e.filter(e=>e.isConnected)),after:c("after",e=>e,e=>e.filter(e=>e.isConnected)),remove:c("remove",()=>[],(e,n)=>n.isConnected?[n]:[]),getBoundingClientRect(){return e(()=>{const e=l(this),t=e.getBoundingClientRect();return d(b(t))})},getClientRects(){return e(()=>{const e=l(this),t=e.getClientRects();for(let e=0;e<t.length;e++)b(t[e]);return d(t)})},removeAttribute:f("removeAttribute",e=>[e[0],""]),removeAttributeNS:f("removeAttributeNS",e=>[e[1],""]),removeAttributeNode:f("removeAttributeNode",e=>[e[0].name,""]),setAttribute:f("setAttribute",e=>e),setAttributeNS:f("setAttributeNS",e=>[e[1],e[2]]),setAttributeNode:f("setAttributeNode",e=>[e[0].name,e[0].value]),setAttributeNodeNS:f("setAttributeNodeNS",e=>[e[0].name,e[0].value]),toggleAttribute:f("toggleAttribute",e=>[e[0],""])}},Event:({callAndWrapError:e,documentView:t,global:n,parent:a,toNativeObject:r,toVirtualObject:o})=>({composedPath(){return e(()=>{const e=r(this).composedPath();return e.filter(e=>e===a||e instanceof a.Node&&t.contains(e)).map(e=>e===a?n:o(e))})}}),FocusEvent:({global:e,toNativeObject:t,toVirtualAny:n})=>({get relatedTarget(){const a=t(this).relatedTarget;return a instanceof e.Object?n(a):null}}),HTMLAnchorElement:({callAndWrapError:e,cspValidation:t,toNativeObject:n})=>({click(){e(()=>{t("sandbox","allow-top-navigation","error")&&t("navigate-to",this.href,"error")&&n(this).click()})}}),HTMLFormElement:({callAndWrapError:e,cspValidation:t,toNativeObject:n})=>({submit(){e(()=>{t("sandbox","allow-forms")&&t("sandbox","allow-top-navigation","error")&&t("navigate-to",this.action,"error")&&n(this).submit()})}}),HTMLScriptElement:({callAndWrapError:e,classRegistry:t,getCurrentNativeObject:n,runScript:a,SandboxSecurityError:r,sanitizer:o,scriptType:i,symbols:l,toNativeObject:s,top:c},{isNull:d})=>{const u=i,m=(e,t,n)=>{if(!o.isValidAttribute(e.nodeName,t,n))throw new r(`Forbidden: attribute [${t}=${JSON.stringify(n)}]`)};return{[l.initialize](){e(()=>(n().setAttribute("type",u),this))},get src(){return e(()=>{const e=s(this),t=e.getAttribute("src");return d(t)?"":new c.URL(t,this.baseURI).href})},set src(t){e(()=>{const e=s(this);m(e,"src",t),e.setAttribute("src",t)})},get type(){return e(()=>{const e=s(this),t=e.getAttribute("type");return d(t)?"":t})},set type(t){e(()=>{const e=s(this);m(e,"type",t),e.setAttribute("type",t)})},[l.connectedCallback](){e(()=>{const e=s(this);if(e.getAttribute("type")!==u)return;const n=t.get("Event");a({element:this,src:this.src,textContent:this.textContent}).then(()=>{this.dispatchEvent(new n("load"))},()=>{this.dispatchEvent(new n("error"))})})}}},MouseEvent:({windowView:e,toNativeObject:t,parent:n})=>{const a=e,r=e=>e.view!==n;return{get clientX(){const e=t(this);if(!r(e)){const t=a.getBoundingClientRect();return e.clientX-t.x}return e.clientX},get clientY(){const e=t(this);if(!r(e)){const t=a.getBoundingClientRect();return e.clientY-t.y}return e.clientY},get x(){return this.clientX},get y(){return this.clientY},get pageX(){return a.scrollLeft+this.clientX},get pageY(){return a.scrollTop+this.clientY}}},Node:({callAndWrapError:e,global:t,parent:n,toNativeObject:a,toVirtualNodeCreater:r})=>{const o=n.document,i=(t,n)=>e(()=>t[n]);return{get ownerDocument(){const e=t.document;return e===this?null:e},get nodeName(){const e=t.document,n=e===this?o:a(this);return i(n,"nodeName")},get nodeType(){const e=t.document,n=e===this?o:a(this);return i(n,"nodeType")},appendChild:r("appendChild",e=>[e[0]],e=>e[0].isConnected?[e[0]]:[]),insertBefore:r("insertBefore",e=>[e[0]],e=>e[0].isConnected?[e[0]]:[]),replaceChild:r("replaceChild",e=>[e[0]],e=>[e[1]]),removeChild:r("removeChild",()=>[],e=>[e[0]])}},ShadowRoot:({callAndWrapError:e,toNativeObject:t,sanitizer:n})=>({get innerHTML(){return e(()=>t(this).innerHTML)},set innerHTML(a){e(()=>{const e=t(this),r=n.sanitize(a);for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(r)})}}),Storage:({callAndWrapError:e,getCurrentNativeObject:t,namespace:n,prefix:a,symbols:r,toNativeObject:o,toVirtualObject:i},{inherits:l,isString:s,keys:c})=>{const d=`${a}${n}.`,u=e=>c(e).filter(e=>0===e.indexOf(d));return{[r.initialize](){return e(()=>l(this,new Proxy(t(),{get(e,t){const n=i(e);return s(t)?n.getItem(t):void 0},set(e,t,n){const a=i(e);return!!s(t)&&(a.setItem(t,n),!0)},deleteProperty(e,t){const n=i(e);return!!s(t)&&(n.removeItem(t),!0)}})))},get length(){return e(()=>u(o(this)).length)},key(t){return e(()=>u(o(this)).map(e=>e.replace(d,""))[t])},getItem(t){return e(()=>o(this).getItem(`${d}${t}`))},setItem(t,n){return e(()=>o(this).setItem(`${d}${t}`,n))},removeItem(t){return e(()=>o(this).removeItem(`${d}${t}`))},clear(){const t=o(this);e(()=>u(t).forEach(e=>t.removeItem(e)))}}},Touch:({windowView:e,toNativeObject:t})=>{const n=e;return{get clientX(){const e=t(this),a=n.getBoundingClientRect();return e.clientX-a.x},get clientY(){const e=t(this),a=n.getBoundingClientRect();return e.clientY-a.y},get pageX(){return n.scrollLeft+this.clientX},get pageY(){return n.scrollTop+this.clientY}}},XMLHttpRequest:({callAndWrapError:e,cspValidation:t,parent:n,toNativeObject:a})=>({open(){return e(()=>{const e=new n.URL(arguments[1],n.document.baseURI);t("connect-src",e.href,"error")&&a(this).open(...arguments)})}})},ut=e=>{const t={};return Object.entries(dt).forEach(([n,a])=>{t[n]=e.call(a)}),e.interfaceGenerator(t,xe)},mt=e=>e.call(ct);var pt=e=>{e.csp=e.csp||"connect-src;form-action;navigate-to;script-src;sandbox",e.permissions=Pe,e.compartment=e.compartment||L();const t=e.compartment,n=t.global,a=e.parent,r=e.windowView,o=P(e),{create:i,inherits:l,isString:s,mixin:c,setPrototypeOf:d}=o;c(o,{CSPValidation:Re,isJavaScriptType:x,Sanitizer:st,utils:o});const u=k(e,o),{bindObject:m,classRegistry:p,console:f,createVirtualClass:b,cspValidation:g,documentView:E,events:h,getCurrentNativeObject:S,runScript:y,symbols:v,toLiveVirtuaObject:C,toVirtualObject:T}=u;["Object","Array","Promise"].forEach(e=>{p.set(e,b(e,{[v.initialize](){return l(this,C(S()))}}))}),c(n,ut(u)),c(n,mt(u)),m(n,r),d(n,i(p.get("Window").prototype)),a.addEventListener("hashchange",e=>{const t=T(new e.constructor(e.type,{newUrl:e.newURL,oldURL:e.oldURL}));n.dispatchEvent(t)});const N=e=>{if(s(e))return;const t=T(e),a=n.customElements.get(1===t.nodeType&&t.getAttribute("is")||t.localName);t[v.connectedCallback]?t[v.connectedCallback]():a&&!(t instanceof a)?u.global.customElements.upgrade(t):a&&t.connectedCallback&&t.connectedCallback(),e.childNodes.forEach(N)},A=e=>{const t=T(e);t[v.disconnectedCallback]?t[v.disconnectedCallback]():n.customElements.get(t.localName)&&t.disconnectedCallback&&t.disconnectedCallback(),e.childNodes.forEach(A)};return h.add("MutationEvent",({addedNodes:e,removedNodes:t})=>{try{t.forEach(A),e.forEach(N)}catch(e){f.error(e)}}),[{tag:"a",allow:"allow-top-navigation",match:"navigate-to",content(){return this.href},action:"click"},{tag:"form",allow:"allow-forms",match:"form-action",content({submitter:e}){if(e){const t=e.getAttribute("formaction");if(t)return e.formAction}return this.action},action:"submit"}].forEach(({tag:e,allow:t,match:n,content:a,action:r})=>{E.addEventListener(r,r=>{r.target.localName!==e||g("sandbox",t,"warn")&&g(n,a.call(r.target,r),"warn")||r.preventDefault()},!0)}),{global:n,evaluate(){return t.evaluate(...arguments)},async bootstrap({src:e,srcdoc:t}){return y({src:e,textContent:t,csp:!1})},async unload(){n.close()}}};let ft,bt=0;const gt=Symbol("closed"),Et=Symbol("virtual-browser");class ht extends HTMLElement{constructor(){if(super(),!ft){const e=document.createElement("style"),t="contain"in this.style?"contain: layout":"transform: scale(1)";e.textContent=`${this.localName} { ${t}; overflow: hidden; }`,document.head.appendChild(e),ft=!0}Reflect.defineProperty(this,"debug",{configurable:!0,get(){return null!==this.getAttribute("debug")},set(e){e?this.setAttribute("debug",""):this.removeAttribute("debug")}})}get name(){return this.getAttribute("name")||""}set name(e){this.setAttribute("name",e)}get src(){const e=this.getAttribute("src");return null===e?"":new URL(e,this.baseURI).href}set src(e){this.setAttribute("src",e)}get srcdoc(){return this.getAttribute("srcdoc")||""}set srcdoc(e){this.setAttribute("srcdoc",e)}get csp(){return this.getAttribute("csp")||""}set csp(e){this.setAttribute("csp",e)}get contentWindow(){return this[Et].global}get contentDocument(){return this[Et].global.document}evaluate(){return this[Et].evaluate(...arguments)}connectedCallback(){if(this[gt])throw TypeError(`The <web-sandbox> has been destroyed`);this[Et]=pt({csp:this.csp,debug:this.debug,documentView:this.attachShadow({mode:"closed"}),namespace:this.name||`sandbox${bt}`,parent:window,title:this.name,top:window,windowView:this}),this[Et].bootstrap({src:this.src,srcdoc:this.srcdoc}).then(()=>{this.dispatchEvent(new Event("load"))},()=>{this.dispatchEvent(new Event("error"))}),bt++}disconnectedCallback(){this[Et].unload(),this[gt]=!0}}window.HTMLWebSandboxElement=ht,window.WebSandbox=R,window.customElements.define("web-sandbox",ht),e.HTMLWebSandboxElement=ht,e.WebSandbox=R,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=web-sandbox.umd.js.map
