(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e=e||self,t(e.WebSandbox={}))})(this,function(e){'use strict';function t(e){return"function"==typeof e}function n(e,t=void 0){const n=`please report internal shim error: ${e}`;console.error(n),t&&(console.error(`${t}`),console.error(`${t.stack}`));debugger;throw n}function a(e,t){e||n(t)}function r(e){let t=`'use strict'; (${e})`;return t=t.replace(/\(0,\s*_[0-9a-fA-F]{3}\u200D\.e\)/g,"(0, eval)"),t=t.replace(/_[0-9a-fA-F]{3}\u200D\.g\./g,""),t=t.replace(/cov_[^+]+\+\+[;,]/g,""),t}function o(e,t){const{callAndWrapError:n}=e,{initRootRealm:a,initCompartment:o,getRealmGlobal:i,realmEvaluate:l}=t,{create:c,defineProperties:s}=Object;class d{constructor(){throw new TypeError("Realm is not a constructor")}static makeRootRealm(t={}){const o=c(d.prototype);return n(a,[e,o,t]),o}static makeCompartment(t={}){const a=c(d.prototype);return n(o,[e,a,t]),a}get global(){return n(i,[this])}evaluate(e,t,a={}){return n(l,[this,e,t,a])}}return s(d,{toString:{value:()=>"function Realm() { [shim code] }",writable:!1,enumerable:!1,configurable:!0}}),s(d.prototype,{toString:{value:()=>"[object Realm]",writable:!1,enumerable:!1,configurable:!0}}),d}function i(e,t=!1){function n(t,n,o,i){for(const l of t){const t=be(e,l);t&&(a("value"in t,`unexpected accessor on global property: ${l}`),r[l]={value:t.value,writable:n,enumerable:o,configurable:i})}}const r={};return t?(n(we,!0,!1,!0),n(Re,!0,!1,!0)):(n(we,!1,!1,!1),n(Re,!1,!1,!1)),n(xe,!0,!1,!0),r}function l(){function e(e){if(e===void 0||null===e)throw new TypeError(`can't convert undefined or null to object`);return Object(e)}function t(e){return"symbol"==typeof e?e:`${e}`}function n(e,t){if("function"!=typeof e)throw TypeError(`invalid ${t} usage`);return e}const{defineProperty:a,defineProperties:r,getOwnPropertyDescriptor:o,getPrototypeOf:i,prototype:l}=Object;try{(0,l.__lookupGetter__)("x")}catch(e){return}r(l,{__defineGetter__:{value:function(t,r){const o=e(this);a(o,t,{get:n(r,"getter"),enumerable:!0,configurable:!0})}},__defineSetter__:{value:function(t,r){const o=e(this);a(o,t,{set:n(r,"setter"),enumerable:!0,configurable:!0})}},__lookupGetter__:{value:function(n){let a=e(this);n=t(n);let r;for(;a&&!(r=o(a,n));)a=i(a);return r&&r.get}},__lookupSetter__:{value:function(n){let a=e(this);n=t(n);let r;for(;a&&!(r=o(a,n));)a=i(a);return r&&r.set}}})}function c(){function e(e,r){let o;try{o=(0,eval)(r)}catch(t){if(t instanceof SyntaxError)return;throw t}const i=n(o),l=function(){throw new TypeError("Not available")};t(l,{name:{value:e}}),t(i,{constructor:{value:l}}),t(l,{prototype:{value:i}}),l!==Function.prototype.constructor&&a(l,Function.prototype.constructor)}const{defineProperties:t,getPrototypeOf:n,setPrototypeOf:a}=Object;e("Function","(function(){})"),e("GeneratorFunction","(function*(){})"),e("AsyncFunction","(async function(){})"),e("AsyncGeneratorFunction","(async function*(){})")}function s(){const e=new Function("try {return this===global}catch(e){return false}")();if(!e)return;const t=require("vm"),n=t.runInNewContext(De);return n}function d(){if("undefined"!=typeof document){const e=document.createElement("iframe");e.style.display="none",document.body.appendChild(e);const t=e.contentWindow.eval(Ie);return t}}function u(e,t=[],n=!1){const a=i(e,n),r=e.eval,o=e.Function,l=r(se)();return me({unsafeGlobal:e,sharedGlobalDescs:a,unsafeEval:r,unsafeFunction:o,callAndWrapError:l,allShims:t})}function m(e,t=!1){const n=Pe(),a=u(n,e,t),{unsafeEval:r}=a;return r(He)(),r(ke)(),a}function p(e,t={}){const n=Ee(e),a=Ce(n,n=>{if(n in t)return!1;if("eval"===n||Ve.has(n)||!Ae(je,n))return!1;const a=be(e,n);return!1===a.configurable&&!1===a.writable&&Te(a,"value")});return a}function b(e){const t=e.search(Be);if(-1!==t){const n=e.slice(0,t).split("\n").length;throw new SyntaxError(`possible html comment syntax rejected around line ${n}`)}}function f(e){const t=e.search(Ge);if(-1!==t){const n=e.slice(0,t).split("\n").length;throw new SyntaxError(`possible import expression rejected around line ${n}`)}}function E(e){const t=e.search(ze);if(-1!==t){const n=e.slice(0,t).split("\n").length;throw new SyntaxError(`possible direct eval expression rejected around line ${n}`)}}function S(e){b(e),f(e),E(e)}function g(e){return 0===e.length?"":`const {${Me(e,",")}} = this;`}function y(e,t){const{unsafeFunction:n}=e,a=g(t);return n(`with (arguments[0]) {${a};return function() {'use strict';return eval(arguments[0]);};}`)}function h(e,t,a,r){const{unsafeEval:o}=e,i=o(Ue);return function(l={},c={}){const s=c.transforms||[],d=Oe(s,a||[],[Ke]);return function(a){let c={src:a,endowments:l};c=i(c,d);const s=p(t,c.endowments),u=p(c.endowments),m=Oe(s,u),b=y(e,m),f=o(Fe)(e,t,c.endowments,r),E=Proxy.revocable({},f),S=E.proxy,g=ye(b,t,[S]);f.useUnsafeEvaluator=!0;let h;try{return ye(g,t,[c.src])}catch(t){throw h=t,t}finally{f.useUnsafeEvaluator&&(E.revoke(),n("handler did not revoke useUnsafeEvaluator",h))}}}}function v(e,t){const{unsafeEval:n,unsafeFunction:r}=e,o=n(_e)(e,t);return a(Se(o).constructor!==Function,"hide Function"),a(Se(o).constructor!==r,"hide unsafeFunction"),o}function T(e){return(t,n,a={})=>e(n,a)(t)}function C(e,t){const{unsafeGlobal:n,unsafeEval:r,unsafeFunction:o}=e,i=r(We)(e,function(...e){const a=`${Ne(e)||""}`;let r=`${Me(e,",")}`;if(!Ae(/^[\w\s,]*$/,r))throw new SyntaxError("shim limitation: Function arg must be simple ASCII identifiers, possibly separated by commas: no default values, pattern matches, or non-ASCII parameter names");if(new o(a),Le(r,")"))throw new n.SyntaxError("shim limitation: Function arg string contains parenthesis");0<r.length&&(r+="\n/*``*/");const i=`(function(${r}){\n${a}\n})`;return t(i)});return a(Se(i).constructor!==Function,"hide Function"),a(Se(i).constructor!==o,"hide unsafeFunction"),i}function N(e){return a(Object(e)===e,"bad object, not a Realm instance"),a(qe.has(e),"Realm instance has no record"),qe.get(e)}function M(e,t){a(Object(e)===e,"bad object, not a Realm instance"),a(!qe.has(e),"Realm instance already has a record"),qe.set(e,t)}function O(e,t,n){pe(e,{eval:{value:t,writable:!0,configurable:!0},Function:{value:n,writable:!0,configurable:!0}})}function A(e,t,n){const{sharedGlobalDescs:a,unsafeGlobal:r}=e,o=ue(r.Object.prototype,a),i=h(e,o,t,n),l=i(),c=v(e,l),s=C(e,l),d=T(i);O(o,c,s);const u=me({safeGlobal:o,safeEval:c,safeEvalWhichTakesEndowments:d,safeFunction:s});return u}function L(){return window.document.createElement("web-sandbox")}let w;const R=t(window.queueMicrotask)?window.queueMicrotask.bind(window):e=>(w||(w=Promise.resolve())).then(e).catch(e=>window.setTimeout(()=>{throw e},0));var x=e=>{const t=t=>e.compartment.evaluate(((e,t)=>()=>{e.cspSandboxCheck(t)}).toString())(e,t);[["allow-top-navigation","HTMLAnchorElement","click"],["allow-forms","HTMLFormElement","submit"]].forEach(([n,a,r,o])=>{e.cspSandboxCheck(n,!1)||(e.documentView.addEventListener(o||r,t=>{t.target instanceof e.parent[a]&&!e.cspSandboxCheck(n)&&t.preventDefault()},!0),e.classRegistry.get(a).prototype[r]=t(r))})};const I=Object.seal(/^data-[\-\w.\u00B7-\uFFFF]/),D=Object.seal(/^aria-[\-\w]+$/),P=Object.seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),H=Object.seal(/^(?:\w+script|data):/i),k=Object.seal(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),{document:j}=window,V=e=>{if("string"==typeof e&&["","module","application/javascript","application/ecmascript","text/javascript","text/ecmascript"].includes(e.trim().toLowerCase()))return!0;let t=window.WEBSANDBOX_PREVENT_SCRIPT_TYPE;if(t||(t=window.WEBSANDBOX_PREVENT_SCRIPT_TYPE=new Map),t.has(e))return t.get(e);t.set(e,!1);const n=j.createElement("script");n.setAttribute("type",e),n.textContent=`${"WEBSANDBOX_PREVENT_SCRIPT_TYPE"}.set(${JSON.stringify(e)}, true)`,j.head.appendChild(n);const a=t.get(e);return j.head.removeChild(n),a},{Node:F,NodeFilter:_,Text:W,Comment:U,NamedNodeMap:B,DocumentFragment:G,document:z}=window,K=Symbol("executeHook"),q=Symbol("sanitizeElements"),X=Symbol("sanitizeAttributes"),Y=Symbol("sanitizeShadowDOM"),Q=Symbol("sanitize"),J=["base","embed","iframe","meta","noscript","object","param","frame","frameset","noframes"],Z=["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"],$=["audio","video","img","source","image","track"],ee=["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"],te=z.createElement("form"),ne=e=>{try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=""}catch(t){e.remove()}}},ae=function(e,t){if(t.removeAttribute(e),"is"===e)try{t.setAttribute(e,"")}catch(e){}},re=e=>{const t=e.match(/^[\r\n\t ]+/),n=t&&t[0],a=z.implementation.createHTMLDocument(""),{body:r}=a;return r.innerHTML=e,e&&n&&a.body.insertBefore(z.createTextNode(n),a.body.childNodes[0]||null),r},oe=e=>(e.ownerDocument||e).createNodeIterator(e,_.SHOW_ELEMENT|_.SHOW_COMMENT|_.SHOW_TEXT,()=>_.FILTER_ACCEPT,!1),ie=e=>!(e instanceof W||e instanceof U)&&!("string"==typeof e.nodeName&&"string"==typeof e.textContent&&"function"==typeof e.removeChild&&e.attributes instanceof B&&"function"==typeof e.removeAttribute&&"function"==typeof e.setAttribute&&"string"==typeof e.namespaceURI&&"function"==typeof e.insertBefore),le=e=>"object"==typeof F?e instanceof F:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName;const ce=r(o),se=r(function(){const{getPrototypeOf:e}=Object,{apply:t}=Reflect,n=e=>(n,...a)=>t(e,n,a),a=n(Map.prototype.get),r=n(Set.prototype.has),o=new Map([["EvalError",EvalError],["RangeError",RangeError],["ReferenceError",ReferenceError],["SyntaxError",SyntaxError],["TypeError",TypeError],["URIError",URIError]]),i=new Set([EvalError.prototype,RangeError.prototype,ReferenceError.prototype,SyntaxError.prototype,TypeError.prototype,URIError.prototype,Error.prototype]);return function(n,l){try{return t(n,void 0,l)}catch(t){if(Object(t)!==t)throw t;if(r(i,e(t)))throw t;let n,l,c;try{n=`${t.name}`,l=`${t.message}`,c=`${t.stack||l}`}catch(e){throw new Error("unknown error")}const s=a(o,n)||Error;try{throw new s(l)}catch(e){throw e.stack=c,e}}}}),{assign:de,create:ue,freeze:me,defineProperties:pe,getOwnPropertyDescriptor:be,getOwnPropertyDescriptors:fe,getOwnPropertyNames:Ee,getPrototypeOf:Se,setPrototypeOf:ge}=Object,{apply:ye,ownKeys:he}=Reflect,ve=e=>(t,...n)=>ye(e,t,n),Te=ve(Object.prototype.hasOwnProperty),Ce=ve(Array.prototype.filter),Ne=ve(Array.prototype.pop),Me=ve(Array.prototype.join),Oe=ve(Array.prototype.concat),Ae=ve(RegExp.prototype.test),Le=ve(String.prototype.includes),we=["Infinity","NaN","undefined"],Re=["isFinite","isNaN","parseFloat","parseInt","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","Array","ArrayBuffer","Boolean","DataView","EvalError","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Map","Number","Object","RangeError","ReferenceError","Set","String","Symbol","SyntaxError","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","URIError","WeakMap","WeakSet","JSON","Math","Reflect","escape","unescape"],xe=["Date","Error","Promise","Proxy","RegExp","Intl"],Ie="'use strict'; this",De=`(0, eval)("'use strict'; this")`,Pe=()=>{const e=d(),t=s();if(!e&&!t||e&&t)throw new Error("unexpected platform, unable to create Realm");return e||t},He=r(l),ke=r(c),je=/^[a-zA-Z_$][\w$]*$/,Ve=new Set(["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","new","return","super","switch","this","throw","try","typeof","var","void","while","with","yield","let","static","enum","implements","package","protected","interface","private","public","await","null","true","false","this","arguments"]),Fe=r(function(e,t,n={},a=!1){const{unsafeGlobal:r,unsafeEval:o}=e,{freeze:i,getOwnPropertyDescriptor:l}=Object,{get:c,set:s}=Reflect,d=new Proxy(i({}),{get(e,t){throw new TypeError(`unexpected scope handler trap called: ${t+""}`)}});return{__proto__:d,useUnsafeEvaluator:!1,get(e,a){return"symbol"==typeof a?void 0:"eval"===a&&!0===this.useUnsafeEvaluator?(this.useUnsafeEvaluator=!1,o):a in n?c(n,a,t):c(t,a)},set(e,a,r){if(a in n){const e=l(n,a);return"value"in e?s(n,a,r):s(n,a,r,t)}return s(t,a,r)},has(e,o){return!!a||!!("eval"===o||o in n||o in t||o in r)},getPrototypeOf(){return null}}}),_e=r(function(e,t){const{callAndWrapError:n}=e,{defineProperties:a}=Object,r={eval(){return n(t,arguments)}}.eval;return a(r,{toString:{value:()=>`function ${"eval"}() { [shim code] }`,writable:!1,enumerable:!1,configurable:!0}}),r}),We=r(function(e,t){const{callAndWrapError:n,unsafeFunction:a}=e,{defineProperties:r}=Object,o=function(){return n(t,arguments)};return r(o,{prototype:{value:a.prototype},toString:{value:()=>"function Function() { [shim code] }",writable:!1,enumerable:!1,configurable:!0}}),o}),Ue=r(function(e,t){const{create:n,getOwnPropertyDescriptors:a}=Object,{apply:r}=Reflect,o=(e=>(t,...n)=>r(e,t,n))(Array.prototype.reduce);return e={src:`${e.src}`,endowments:n(null,a(e.endowments))},e=o(t,(e,t)=>t.rewrite?t.rewrite(e):e,e),e={src:`${e.src}`,endowments:n(null,a(e.endowments))},e}),Be=/(?:<!--|-->)/,Ge=/\bimport\s*(?:\(|\/[/*])/,ze=/\beval\s*(?:\(|\/[/*])/,Ke={rewrite(e){return S(e.src),e}},qe=new WeakMap,Xe={initRootRealm:function(e,t,n){const{shims:a,transforms:r,sloppyGlobals:o,configurableGlobals:i}=n,l=Oe(e.allShims,a),c=m(l,i),{unsafeEval:s}=c,d=s(ce)(c,Xe);c.sharedGlobalDescs.Realm={value:d,writable:!0,configurable:!0};const u=A(c,r,o),{safeEvalWhichTakesEndowments:p}=u;for(const a of l)p(a);M(t,u)},initCompartment:function(e,t,n={}){const{transforms:a,sloppyGlobals:r}=n,o=A(e,a,r);M(t,o)},getRealmGlobal:function(e){const{safeGlobal:t}=N(e);return t},realmEvaluate:function(e,t,n={},a={}){const{safeEvalWhichTakesEndowments:r}=N(e);return r(t,n,a)}},Ye=function(){const e=eval,t=e(Ie);return l(),c(),u(t)}(),Qe=o(Ye,Xe);let Je;var Ze=()=>{if(!Je){Je=Qe.makeRootRealm();const e=window.document.body.lastChild;if("IFRAME"===e.nodeName&&e.contentWindow&&Je.global instanceof e.contentWindow.Object){const t=e.contentDocument;t.removeChild(t.documentElement),Object.defineProperties(e,{contentWindow:{},contentDocument:{}})}}const e=Je.global.Realm.makeCompartment(),t=e.evaluate;return e.evaluate=function(e,...n){return e=e.replace(/\.import\(/g,`['import'](`),t.call(this,e,...n)},e},$e=({title:e,namespace:t,permissions:n,compartment:a,top:r,parent:o,windowView:i,documentView:l,csp:c,debug:s},d)=>{const u={};return u.title=e,u.namespace=t,u.permissions=n,u.compartment=a,u.global=a.global,u.top=r,u.parent=o,u.debug=s,u.windowView=i,u.documentView=l,u.csp=c,u.currentNativeObject=null,u.SandboxSecurityError=class extends TypeError{constructor(){super(...arguments),this.name="WebSandboxSecurityError"}},u.toNativeObject=function(e){const t=u.toNativeObject.cache.get(e);return t?t:e},u.toNativeObject.cache=new WeakMap,u.toVirtualObject=function(e){if(u.toVirtualObject.cache.has(e))return u.toVirtualObject.cache.get(e);let t;if(e===u.windowView)t=u.classRegistry.get("Window");else if(e===u.documentView)t=u.classRegistry.get("HTMLDocument");else{const n=e.constructor.name||e[Symbol.toStringTag];t=u.classRegistry.get(n)}if(!t||[u.parent,u.parent.document].includes(e)||e.isConnected&&e instanceof u.parent.Node&&u.parent.document.documentElement.contains(e))throw new u.SandboxSecurityError(`Forbidden: ${e.toString()}`);u.currentNativeObject=e;const n=Reflect.construct(t,[e]);return u.currentNativeObject=null,u.bindObject(n,e),n},u.toVirtualObject.cache=new WeakMap,u.bindObject=function(e,t){u.toNativeObject.cache.set(e,t),u.toVirtualObject.cache.set(t,e)},u.toNativeFunction=function(e){if(u.toNativeFunction.cache.has(e))return u.toNativeFunction.cache.get(e);const t=e=>e.map(e=>u.toVirtualAny(e)),n=function(...n){const a=this,r=a?u.toVirtualObject(a):void 0,o=t(n),i=Reflect.apply(e,r,o);return u.toNativeAny(i)};return Reflect.defineProperty(n,"name",{value:e.name,configurable:!0}),u.toNativeFunction.cache.set(e,n),n},u.toNativeFunction.cache=new WeakMap,u.toVirtualFunction=function(e){if(u.toVirtualFunction.cache.has(e))return u.toVirtualFunction.cache.get(e);const t=e=>e.map(e=>u.toNativeAny(e)),n=function(...n){const a=this,r=a?u.toNativeObject(a):void 0,o=t(n),i=Reflect.apply(e,r,o);return u.toVirtualAny(i)};return Reflect.defineProperty(n,"name",{value:e.name,configurable:!0}),u.toVirtualFunction.cache.set(e,n),n},u.toVirtualFunction.cache=new WeakMap,u.toVirtualAny=function(e){return d.isObject(e)?u.toVirtualObject(e):d.isFunction(e)?u.toVirtualFunction(e):e},u.toNativeAny=function(e){return d.isObject(e)?u.toNativeObject(e):d.isFunction(e)?u.toNativeFunction(e):e},u.classRegistry=new Map,u},et=(e,t)=>{const n=e,a=t.cspParser(e.csp),r={Window:e.windowView.constructor,Document:e.documentView.constructor};n.prefix=`${e.windowView.localName}.`,n.scriptType=`${n.prefix}script`,n.currentScript=null,n.elementDefined=`${n.prefix}defined`,n.Symbol={connectedCallback:Symbol("connectedCallback"),disconnectedCallback:Symbol("disconnectedCallback"),adoptedCallback:Symbol("adoptedCallback"),attributeChangedCallback:Symbol("attributeChangedCallback")},n.cspSandboxCheck=(e,t=!0)=>!!(a.sandbox&&a.sandbox.includes(e))||(t&&n.console.error(`The document is sandboxed, and the '${e}' keyword is not set.`),!1),n.console=Object.entries(e.parent.console).reduce((t,[n,a])=>(t[n]=e.debug?a:function(){a(...arguments)},t),{}),n.script=({src:n,textContent:a,currentScript:r=null})=>{const o=e.top.fetch,i=e.global.Error,l=e.classRegistry.get("ErrorEvent"),c=n=>{e.currentScript=r;try{e.compartment.evaluate(n)}catch(n){r&&e.global.dispatchEvent(new l("error",n)),t.queueMicrotask(()=>{throw n})}e.currentScript=null};return n?o(n,{credentials:"same-origin"}).then(t=>{if(!t.ok)throw i([t.status,t.statusText,n].join(", "));const a=t.headers.get("content-type");if(!a||!/^(text|application)\/(x-)?javascript(;|$)/.test(a))throw i(a);return t.text().then(t=>{const a=/(\/\/# sourceURL=)((https?:\/\/)?([\w-])+\.{1}([a-zA-Z]{2,63})([/\w-]*)*\/?\??([^#\n\r]*)?)/;a.test(t)?t=t.replace(a,(t,a,r)=>`${a}${e.top.URL(r,n).href}`):t+=`\n//# sourceURL=${n}`,c(t)})}):(a&&c(a),Promise.resolve())},n.sanitizer=new t.Sanitizer({...["allowElements","blockElements","dropElements","allowAttributes","dropAttributes"].reduce((t,n)=>(t[n]=e.permissions[n],t),{}),uponSanitizeElement(a,r){"script"===r.tagName&&t.isJavaScriptType(a.type)?a.setAttribute("type",n.scriptType):e.parent.customElements.get(r.name)&&a.parentNode.removeChild()}}),n.run=n=>e.debug?n(e,t):e.compartment.evaluate(n.toString())(e,t),n.configToMap=n=>{const a=n=>{const a=new Map,r=new Set(["length","arguments","caller","prototype","name"]),o=new Set(["constructor"]),i=(e,t)=>[...Object.keys(e).filter(e=>!r.has(e)),...Object.keys(t).filter(e=>!o.has(e))];return n.forEach(n=>{const r=n.name||n,o=n.value,l=e.parent[r]||{},c=l.prototype||{};t.isArray(o)?a.set(r,new Set(o)):a.set(r,new Set(i(l,c)))}),a};return{allowInterfaces:a(n.allowInterfaces),blockInterfaces:a(n.blockInterfaces)}};const o=["getPrototypeOf","setPrototypeOf","isExtensible","preventExtensions","getOwnPropertyDescriptor","defineProperty","has","get","set","deleteProperty","ownKeys","apply","construct"].reduce((t,n)=>(t[n]=(...t)=>e.toVirtualAny(Reflect[n](...t.map(t=>e.toNativeAny(t)))),t),{}),i=(n,a,r,i,l)=>(a=a||function(){let n=this;if(e.currentNativeObject)r&&Reflect.construct(r,arguments,a),l&&(n=t.inherits(n,new Proxy(e.currentNativeObject,o)));else{const t=Array.from(arguments).map(t=>e.toNativeAny(t)),a=Reflect.construct(i,t);n=e.toVirtualObject(a)}return n},r&&(Reflect.setPrototypeOf(a,r),a.prototype=Object.create(r.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})),Reflect.defineProperty(a,"name",{value:n,writable:!1,enumerable:!1,configurable:!0}),i.prototype&&Reflect.defineProperty(a.prototype,Symbol.toStringTag,{value:i.prototype[Symbol.toStringTag],enumerable:!1,writable:!1,configurable:!0}),a);return n.createVirtualClass=(t,n,a,r)=>{n||(n={});const o=e.parent[t],l=Reflect.getPrototypeOf(o);a=a||e.classRegistry.get(l.name);const c=Reflect.getOwnPropertyDescriptor(n,"constructor"),s=i(t,c?c.value:null,a,o,r);return Reflect.ownKeys(n).forEach(e=>{Reflect.defineProperty(s.prototype,e,Reflect.getOwnPropertyDescriptor(n,e))}),s},n.interfaceGenerator=(a,o)=>{const i=e.configToMap(e.permissions),l=(i,c)=>{if(e.global[i])return e.global[i];if(!c.has(i))throw new e.SandboxSecurityError(`"${i}" is not in the allowed list`);if(e.classRegistry.has(i))return e.classRegistry.get(i);const s=e.parent[i],d=r[i]||s;if(!t.isObject(s)&&!t.isFunction(s))return s;let u;const m=Reflect.getPrototypeOf(s),p=m.name;p&&(u=e.classRegistry.get(p),!u&&(u=l(p,c)));const b=a[i]||{},f=o.includes(i),E=n.createVirtualClass(i,b,u,f);return n.importPropertys(E,d,[...c.get(i).values()]),e.classRegistry.set(i,E),E};return[...i.allowInterfaces.keys()].reduce((e,t)=>{const n=l(t,i.allowInterfaces);return n&&(e[t]=n),e},{})},n.importPropertys=(n,a,r)=>{const o=(t,n)=>{const a=e.parent.Reflect.getOwnPropertyDescriptor(t,n);if(!a){const a=e.parent.Reflect.getPrototypeOf(t);return a?o(a,n):void 0}return a},i=(t,n,a)=>{if(!t.hasOwnProperty(a)){const r=o(n,a);r&&(Reflect.ownKeys(r).forEach(t=>{r[t]=e.toVirtualAny(r[t])}),Reflect.defineProperty(t,a,r))}};r.forEach(e=>{i(n,a,e),t.isFunction(a)&&a.prototype&&i(n.prototype,a.prototype,e)})},n},tt=(e,t)=>{const n=e.compartment,a=(e,a)=>a.debug?e(a,t):n.evaluate(e.toString())(a,t),r=a($e,e);return a(et,r),r};const nt=(e,t=/^(on)[\w]+/)=>Object.keys("string"==typeof e?window[e].prototype:e).filter(e=>t.test(e));var at={allowInterfaces:["AggregateError","AnalyserNode","Animation","AnimationEffect","AnimationEvent","AnimationPlaybackEvent","AnimationTimeline","atob","Atomics","Attr","Audio","AudioBuffer","AudioBufferSourceNode","AudioContext","AudioDestinationNode","AudioListener","AudioNode","AudioParam","AudioParamMap","AudioProcessingEvent","AudioScheduledSourceNode","BaseAudioContext","BeforeUnloadEvent","Blob","BlobEvent","blur","btoa","ByteLengthQueuingStrategy","cancelAnimationFrame","CanvasCaptureMediaStreamTrack","CanvasGradient","CanvasPattern","CanvasRenderingContext2D","CDATASection","ChannelMergerNode","ChannelSplitterNode","CharacterData","clearInterval","clearTimeout","Clipboard","ClipboardEvent","ClipboardItem","close","closed","Comment","CompositionEvent","CompressionStream","console","ConstantSourceNode","ConvolverNode","CountQueuingStrategy","createImageBitmap","CSS","CSS2Properties","CSSAnimation","CSSConditionRule","CSSFontFaceRule","CSSGroupingRule","CSSImageValue","CSSImportRule","CSSKeyframeRule","CSSKeyframesRule","CSSKeywordValue","CSSMathInvert","CSSMathMax","CSSMathMin","CSSMathNegate","CSSMathProduct","CSSMathSum","CSSMathValue","CSSMatrixComponent","CSSMediaRule","CSSNamespaceRule","CSSNumericArray","CSSNumericValue","CSSPageRule","CSSPerspective","CSSPositionValue","CSSPropertyRule","CSSRotate","CSSRule","CSSRuleList","CSSScale","CSSSkew","CSSSkewX","CSSSkewY","CSSStyleDeclaration","CSSStyleRule","CSSStyleSheet","CSSStyleValue","CSSSupportsRule","CSSTransformComponent","CSSTransformValue","CSSTransition","CSSTranslate","CSSUnitValue","CSSUnparsedValue","CSSVariableReferenceValue","CustomElementRegistry","customElements","CustomEvent","DataTransfer","DataTransferItem","DataTransferItemList","DelayNode","DeviceMotionEvent","DeviceMotionEventAcceleration","DeviceMotionEventRotationRate","DeviceOrientationEvent","devicePixelRatio",{name:"Document",value:["activeElement","adoptNode","body","characterSet","childElementCount","children","contentType","createAttribute","createAttributeNS","createCDATASection","createComment","createDocumentFragment","createElement","createElementNS","createEvent","createNodeIterator","createProcessingInstruction","createTextNode","createTreeWalker","defaultView","documentElement","documentURI","domain","firstElementChild","getAnimations","getElementById","getElementsByClassName","getElementsByName","getElementsByTagName","getElementsByTagNameNS","head","hidden","importNode","lastElementChild",...nt("Document"),"querySelector","querySelectorAll","readyState","styleSheets","title","URL","visibilityState"]},{name:"DocumentFragment",value:["append","childElementCount","children","firstElementChild","getElementById","lastElementChild","prepend","querySelector","querySelectorAll","replaceChildren"]},"DocumentTimeline","DOMError","DOMException","DOMMatrix","DOMMatrixReadOnly","DOMPoint","DOMPointReadOnly","DOMQuad","DOMRect","DOMRectList","DOMRectReadOnly","DOMStringList","DOMStringMap","DOMTokenList","DragEvent","DynamicsCompressorNode",{name:"Element",value:["after","animate","append","attachShadow","attributes","attributeStyleMap","before","childElementCount","children","classList","className","clientHeight","clientLeft","clientTop","clientWidth","closest","computedStyleMap","firstElementChild","getAnimations","getAttribute","getAttributeNames","getAttributeNode","getAttributeNodeNS","getAttributeNS","getBoundingClientRect","getClientRects","getElementsByClassName","getElementsByTagName","getElementsByTagNameNS","hasAttribute","hasAttributeNS","hasAttributes","id","innerHTML","insertAdjacentElement","insertAdjacentHTML","insertAdjacentText","lastElementChild","localName","matches","namespaceURI","nextElementSibling","outerHTML","part","prefix","previousElementSibling","querySelector","querySelectorAll","remove","removeAttribute","removeAttributeNode","removeAttributeNS","scroll","scrollBy","scrollHeight","scrollIntoView","scrollLeft","scrollTo","scrollTop","scrollWidth","setAttribute","setAttributeNode","setAttributeNodeNS","setAttributeNS","shadowRoot","tagName","toggleAttribute",...nt("Element",/^(aria|on)[\w]+/)]},"ElementInternals","ErrorEvent",{name:"Event",value:["bubbles","cancelable","currentTarget","defaultPrevented","eventPhase","initEvent","preventDefault","stopImmediatePropagation","stopPropagation","target","timeStamp","type"]},{name:"EventTarget",value:["addEventListener","dispatchEvent","removeEventListener"]},"focus","FocusEvent","FontFace","FontFaceSetLoadEvent","GainNode","getComputedStyle","HashChangeEvent","HTMLAllCollection","HTMLAnchorElement","HTMLAreaElement","HTMLAudioElement","HTMLQuoteElement",{name:"HTMLBodyElement",value:nt("HTMLBodyElement")},"HTMLBRElement","HTMLButtonElement","HTMLCanvasElement","HTMLCollection","HTMLTableCaptionElement","HTMLTableColElement","HTMLDataElement","HTMLDataListElement","HTMLDocument",{name:"HTMLElement",value:["accessKey","autofocus","blur","click","dataset","dir","draggable","focus","hidden","innerText","lang","offsetHeight","offsetLeft","offsetParent","offsetTop","offsetWidth",...nt("HTMLElement"),"spellcheck","style","tabIndex","title"]},"HTMLModElement","HTMLDetailsElement","HTMLDialogElement","HTMLDivElement","HTMLDListElement","HTMLFieldSetElement","HTMLFormElement","HTMLHeadingElement","HTMLHeadElement","HTMLHRElement","HTMLHtmlElement","HTMLImageElement","HTMLInputElement","HTMLLabelElement","HTMLLegendElement","HTMLLIElement","HTMLLinkElement","HTMLMapElement","HTMLMediaElement","HTMLMeterElement","HTMLMenuElement","HTMLOListElement","HTMLOptGroupElement","HTMLOptionElement","HTMLOptionsCollection","HTMLOutputElement","HTMLParagraphElement","HTMLPictureElement","HTMLPreElement","HTMLProgressElement","HTMLScriptElement","HTMLSelectElement",{name:"HTMLSlotElement",value:[]},"HTMLSourceElement","HTMLSpanElement","HTMLStyleElement","HTMLTableElement","HTMLTableSectionElement","HTMLTableCellElement","HTMLTemplateElement","HTMLTextAreaElement","HTMLTimeElement","HTMLTitleElement","HTMLTableRowElement","HTMLTrackElement","HTMLUListElement","HTMLUnknownElement","HTMLVideoElement","IIRFilterNode","Image","ImageBitmap","ImageBitmapRenderingContext","ImageCapture","ImageData","innerHeight","innerWidth","InputEvent","Keyboard","KeyboardEvent","KeyboardLayoutMap","KeyframeEffect",{name:"localStorage",value:[]},"Location","location","matchMedia","MediaCapabilities","MediaDeviceInfo","MediaDevices","MediaElementAudioSourceNode","MediaError","MediaKeyMessageEvent","MediaKeys","MediaKeySession","MediaKeyStatusMap","MediaKeySystemAccess","MediaList","MediaMetadata","MediaQueryList","MediaQueryListEvent","MediaRecorder","MediaSession","MediaSource","MediaStream","MediaStreamAudioDestinationNode","MediaStreamAudioSourceNode","MediaStreamTrack","MediaStreamTrackEvent","menubar","MessageChannel","MessageEvent","MessagePort",{name:"MouseEvent",value:["altKey","button","ctrlKey","metaKey","offsetX","offsetY","relatedTarget","shiftKey","x","y"]},"MutationObserver","MutationRecord","name","NamedNodeMap","NavigationPreloadManager",{name:"Navigator",value:["language","languages","userAgent"]},"navigator",{name:"Node",value:["appendChild","ATTRIBUTE_NODE","baseURI","CDATA_SECTION_NODE","childNodes","cloneNode","COMMENT_NODE","contains","DOCUMENT_FRAGMENT_NODE","DOCUMENT_NODE","DOCUMENT_POSITION_CONTAINED_BY","DOCUMENT_POSITION_CONTAINS","DOCUMENT_POSITION_DISCONNECTED","DOCUMENT_POSITION_FOLLOWING","DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC","DOCUMENT_POSITION_PRECEDING","DOCUMENT_TYPE_NODE","ELEMENT_NODE","ENTITY_NODE","ENTITY_REFERENCE_NODE","firstChild","hasChildNodes","insertBefore","isConnected","isEqualNode","lastChild","nextSibling","nodeName","nodeType","nodeValue","normalize","NOTATION_NODE","ownerDocument","parentNode","previousSibling","PROCESSING_INSTRUCTION_NODE","removeChild","replaceChild","textContent","TEXT_NODE"]},"NodeFilter","NodeIterator","NodeList","Notification","OfflineAudioCompletionEvent","OfflineAudioContext","offscreenBuffering","OffscreenCanvas","OffscreenCanvasRenderingContext2D",...nt(window),"outerHeight","outerWidth","OverconstrainedError","PageTransitionEvent","pageXOffset","pageYOffset","Path2D","RadioNodeList","requestAnimationFrame","requestIdleCallback","ResizeObserver","ResizeObserverEntry","ResizeObserverSize","setInterval","setTimeout",{name:"ShadowRoot",value:["activeElement","delegatesFocus","getAnimations","host","innerHTML","mode","styleSheets"]},"SharedArrayBuffer","SourceBuffer","SourceBufferList","speechSynthesis","SpeechSynthesisErrorEvent","SpeechSynthesisEvent","SpeechSynthesisUtterance",{name:"Storage",value:["clear","getItem","key","length","removeItem","setItem"]},"StorageEvent","StorageManager","styleMedia","StylePropertyMap","StylePropertyMapReadOnly","StyleSheet","StyleSheetList","SubmitEvent",{name:"Text",value:["wholeText"]},"TextDecoder","TextDecoderStream","TextEncoder","TextEncoderStream","TextEvent","TextMetrics","TextTrack","TextTrackCue","TextTrackCueList","TextTrackList","Touch","TouchEvent","TouchList","TrackEvent","TransformStream","TransitionEvent","TreeWalker","TrustedHTML","TrustedScript","TrustedScriptURL","TrustedTypePolicy","TrustedTypePolicyFactory","trustedTypes",{name:"UIEvent",value:["detail"]},"URL","URLSearchParams","VideoPlaybackQuality","WebGL2RenderingContext","WebGLActiveInfo","WebGLBuffer","WebGLContextEvent","WebGLFramebuffer","WebGLProgram","WebGLQuery","WebGLRenderbuffer","WebGLRenderingContext","WebGLSampler","WebGLShader","WebGLShaderPrecisionFormat","WebGLSync","WebGLTexture","WebGLTransformFeedback","WebGLUniformLocation","WebGLVertexArrayObject","WheelEvent",{name:"Window",value:[]},"WritableStream","WritableStreamDefaultWriter"],blockInterfaces:[],allowElements:[],blockElements:[],dropElements:[],allowAttributes:[],dropAttributes:[]},rt={allow:["Array","AudioParamMap","CSSKeyframesRule","CSSNumericArray","CSSRuleList","CSSStyleDeclaration","CSSTransformValue","CSSUnparsedValue","DataTransferItemList","DOMRectList","DOMStringList","DOMTokenList","EventCounts","FileList","FormData","Headers","HTMLAllCollection","HTMLCollection","HTMLFormControlsCollection","HTMLFormElement","HTMLOptionsCollection","HTMLSelectElement","KeyboardLayoutMap","MediaKeyStatusMap","MediaList","MIDIInputMap","MIDIOutputMap","MimeTypeArray","NamedNodeMap","NodeList","Object","Plugin","PluginArray","Promise","RadioNodeList","RTCStatsReport","SourceBufferList","StylePropertyMap","StylePropertyMapReadOnly","StyleSheetList","SVGLengthList","SVGNumberList","SVGPointList","SVGStringList","SVGTransformList","TextTrackCueList","TextTrackList","TouchList","XRAnchorSet","XRInputSourceArray"]},ot=e=>{const t=[],n=[],a=[],r=t=>{if(!["https:","http:"].includes(new e.top.URL(t,e.top.document.baseURI).protocol))throw new e.SandboxSecurityError(`Forbidden: url [${JSON.stringify(t)}]`)};return{name:e.namespace,window:e.global,self:e.global,constructor:e.classRegistry.get("Window"),console:e.console,localStorage:e.toVirtualObject(e.parent.localStorage),navigator:e.toVirtualObject(e.parent.navigator),customElements:e.toVirtualObject(e.parent.customElements),document:(()=>{const t=e.parent.document,n=e.toVirtualObject(e.documentView),a=t.createElement("html"),r=t.createElement("head"),o=t.createElement("title"),i=t.createElement("body");o.textContent=e.title,r.appendChild(o);const l=t.createElement("style");return l.textContent=`body { height: min-content }`,r.appendChild(l),a.appendChild(r),a.appendChild(i),e.documentView.appendChild(a),n})(),location:Object.defineProperties(e.toVirtualObject(e.parent.location),{...["href","protocol","host","hostname","port","pathname","search","hash","username","password","origin"].reduce((t,n)=>(t[n]={enumerable:!0,get(){return e.parent.location[n]},set(t){e.cspSandboxCheck("allow-top-navigation")&&(["href","protocol"].includes(n)&&r(t),e.parent.location[n]=t)}},t),{}),...["assign","reload","replace"].reduce((t,n)=>(t[n]={enumerable:!0,value(...t){e.cspSandboxCheck("allow-top-navigation")&&(["assign","replace"].includes(n)&&r(t[0]),e.parent.location[n](...t))}},t),{}),...{toString:{enumerable:!0,value(){return this.href}}}}),close(){e.global.closed||(this.dispatchEvent(new this.Event("beforeunload")),this.dispatchEvent(new this.Event("pagehide")),this.dispatchEvent(new this.Event("unload")),t.forEach(e=>this.clearTimeout(e)),n.forEach(e=>this.clearInterval(e)),a.forEach(e=>this.cancelAnimationFrame(e)),this.document.removeChild(this.document.documentElement),e.global.closed=!0)},setTimeout(n,...a){if("string"==typeof n)throw new e.SandboxSecurityError(`The first parameter must be a function`);return t.push(e.parent.setTimeout(n.bind(this),...a))},clearTimeout(n){const a=t.indexOf(n);-1!==a&&(t.splice(a,1),e.parent.clearTimeout(n))},setInterval(t,...a){if("string"==typeof t)throw new e.SandboxSecurityError(`The first parameter must be a function`);return n.push(e.parent.setInterval(t.bind(this),...a))},clearInterval(t){const a=n.indexOf(t);-1!==a&&(n.splice(a,1),e.parent.clearInterval(t))},requestAnimationFrame(t){return a.push(e.parent.requestAnimationFrame(t.bind(this)))},cancelAnimationFrame(t){const n=a.indexOf(t);-1!==n&&(a.splice(n,1),e.parent.cancelAnimationFrame(t))},getComputedStyle(t,n){const a=e.toNativeObject(t),r=e.parent.getComputedStyle(a,n);return e.toVirtualObject(r)},atob(){return e.parent.atob(...arguments)},btoa(){return e.parent.btoa(...arguments)}}};const it={Sanitizer:class e{constructor(e={}){this.config=e}[K](e,t,n){const a=this.config[e];a&&a.call(this,t,n,this.config)}[q](e){const{allowElements:t,dropElements:n}=this.config;if(this[K]("beforeSanitizeElements",e,null),ie(e))return ne(e),!0;if(e.nodeName.match(/[\u0080-\uFFFF]/))return ne(e),!0;const a=e.nodeName.toLowerCase();if(this[K]("uponSanitizeElement",e,{tagName:a,allowElements:t}),"script"===a&&!e.type)return ne(e),!0;if(("svg"===a||"math"===a)&&0!==e.querySelectorAll("p, br, form, table, h1, h2, h3, h4, h5, h6").length)return ne(e),!0;if(!le(e.firstElementChild)&&(!le(e.content)||!le(e.content.firstElementChild))&&/<[/\w]/g.test(e.innerHTML)&&/<[/\w]/g.test(e.textContent))return ne(e),!0;if(!this.isValidElement(a)){const t=!J.includes(a)&&n&&!n.includes(a);if(t&&!Z.includes(a)){const t=e.parentNode,n=e.childNodes,a=n.length;for(let r=a-1;0<=r;--r)t.insertBefore(n[r].cloneNode(!0),e.nextSibling)}return ne(e),!0}return("noscript"===a||"noembed"===a)&&/<\/no(script|embed)/i.test(e.innerHTML)?(ne(e),!0):(this[K]("afterSanitizeElements",e,null),!1)}isValidAttribute(e,t,n){const{allowAttributes:a,dropAttributes:r}=this.config,o=e.toLowerCase(),i=t.toLowerCase();if(("id"===i||"name"===i)&&(n in z||n in te))return!1;if(0===i.indexOf("on")||"script"===o&&"type"===i&&V(n))return!1;if(I.test(i));else if(D.test(i));else{if(r&&r.includes(i)||a&&a.length&&!a.includes(i))return!1;if(ee.includes(i));else if(P.test(n.replace(k,"")));else if(("src"===i||"xlink:href"===i||"href"===i)&&"script"!==o&&0===n.indexOf("data:")&&$.includes(o));else if(!H.test(n.replace(k,"")));else if(!n);else return!1}return!0}isValidElement(e){const{allowElements:t,blockElements:n,dropElements:a}=this.config,r=e.toLowerCase();return!J.includes(r)&&!(a&&a.includes(r)||n&&n.includes(r)||t&&t.length&&!t.includes(r))}[X](e){const{allowAttributes:t}=this.config,n=e.nodeName;let a,r,o,i;this[K]("beforeSanitizeAttributes",e,null);const{attributes:c}=e;if(c){const l={name:"",value:"",keep:!0,allowAttributes:t};for(i=c.length;i--;){a=c[i];const{name:t}=a;(r=a.value.trim(),o=t,l.name=o,l.value=r,l.keep=void 0,this[K]("uponSanitizeAttribute",e,l),r=l.value,!l.keep)&&(this.isValidAttribute(n,o,r)||ae(t,e))}this[K]("afterSanitizeAttributes",e,null)}}[Y](e){let t;const n=oe(e);for(this[K]("beforeSanitizeShadowDOM",e,null);t=n.nextNode();)(this[K]("uponSanitizeShadowNode",t,null),!this[q](t))&&(t.content instanceof G&&this[Y](t.content),this[X](t));this[K]("afterSanitizeShadowDOM",e,null)}[Q](e,t){e=`${e}`;const n=re(e);if(!n)return t?z.createDocumentFragment():"";const a=oe(n);for(let n;n=a.nextNode();)this[q](n)||(n.content instanceof G&&this[Y](n.content),this[X](n));if(t){const e=n.ownerDocument.createDocumentFragment();if(n)for(;n.firstChild;)e.appendChild(n.firstChild);return e}const r=n.innerHTML;return r}sanitize(e){return this[Q](e,!0)}sanitizeToString(e){return this[Q](e)}},isJavaScriptType:V,isArray:function(e){return Array.isArray(e)},isObject:function(e){return"object"==typeof e&&null!==e},isFunction:t,inherits:function(e,t){return new Proxy(e,{get(e,n,a){const r=Reflect.has(e,n)?[e,n,a]:[t,n];return Reflect.get(...r)},has(e,n){return Reflect.has(e,n)||Reflect.has(t,n)},ownKeys(e){return new Set(...Reflect.ownKeys(e),...Reflect.ownKeys(t))},set(e,n,a,r){const o=Reflect.has(e,n)?[e,n,a,r]:[t,n,a];return Reflect.set(...o)},deleteProperty(e,n){return Reflect.deleteProperty(Reflect.has(e,n)?e:t,n)},getOwnPropertyDescriptor(e,n){return Reflect.getOwnPropertyDescriptor(Reflect.has(e,n)?e:t,n)}})},queueMicrotask:R,cspParser:function(e){return e.split(";").reduce((e,t)=>{const[n,...a]=t.trim().split(/\s+/g);return n&&!Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=a),e},{})}},lt={CustomElementRegistry:(e,t)=>{const n=new Map,a=new Map;return{define(t,r,o={}){if(!t.includes("-")&&a.has(t))throw new TypeError(`Illegal constructor`);if(a.set(t,{constructor:r,observedAttributes:r.observedAttributes||[],extends:o.extends}),e.global.document.querySelectorAll(t).forEach(e=>{this.upgrade(e)}),n.has(t))for(let e;e=n.get(t).shift();)e()},get(e){const t=a.get(e);return t?t.constructor:void 0},upgrade(n){const r=e.toNativeObject(n),o=n.localName,i=a.get(o);if(i&&!(n instanceof i.constructor)){e.currentNativeObject=r;const a=Reflect.construct(i.constructor,[]);if(e.currentNativeObject=null,Reflect.setPrototypeOf(n,t.inherits(a,Object.create(i.constructor.prototype))),r.setAttribute(e.elementDefined,""),i.observedAttributes.length&&n.attributeChangedCallback){const t=new e.parent.MutationObserver(e=>{e.forEach(({target:e,attributeName:t,oldValue:a})=>{n.attributeChangedCallback(t,a,e.getAttribute(t))})});t.observe(r,{attributes:!0,attributeOldValue:!0,attributeFilter:i.observedAttributes})}e.bindObject(n,r)}},whenDefined(e){return a.get(e)?Promise.resolve():new Promise((t)=>{n.has(e)||n.set(e,[]),n.get(e).push(t)})}}},Document:e=>{const t=new WeakMap,n=e.parent.document,a=t=>function(){const n=Array.from(arguments).map(t=>e.toNativeAny(t)),a=e.parent.document[t](...n),r=e.toVirtualAny(a);return r},r=t=>{if(t=t.toLowerCase(),!e.sanitizer.isValidElement(t)||e.parent.customElements.get(t))throw new e.SandboxSecurityError(`Forbidden: tag <${t} />`)},o=a("createAttribute"),i=a("createAttributeNS"),l=a("createCDATASection"),c=a("createComment"),s=a("createDocumentFragment"),d=a("createElement"),u=a("createElementNS"),m=a("createEvent"),p=a("createProcessingInstruction"),b=a("createTextNode"),f=a("createTreeWalker"),E=a("createNodeIterator"),S=a("importNode"),g=a("adoptNode"),y={get body(){return this.querySelector("body")},get documentElement(){return this.querySelector("html")},get head(){return this.querySelector("head")},get title(){return this.querySelector("title").textContent},set title(e){this.querySelector("title").textContent=e},get hidden(){return n.hiddent},get visibilityState(){return n.visibilityState},get defaultView(){return e.global},get readyState(){return n.readyState},get documentURI(){return n.documentURI},get domain(){return n.domain},get URL(){return n.URL},get characterSet(){return n.characterSet},get contentType(){return n.contentType},get currentScript(){return e.currentScript},createAttribute:o,createAttributeNS:i,createCDATASection:l,createComment:c,createDocumentFragment:s,createElement(){r(arguments[0]);const t=d.apply(this,arguments);return e.global.customElements.upgrade(t),t},createElementNS(){r(arguments[1]);const t=u.apply(this,arguments);return e.global.customElements.upgrade(t),t},createEvent:m,createProcessingInstruction:p,createTextNode:b,createTreeWalker:f,createNodeIterator:E,importNode:S,adoptNode:g};return Object.keys(e.parent.Document.prototype).filter(e=>/^on[\w\W]+$/.test(e)).forEach(e=>{Reflect.defineProperty(y,e,{enumerable:!0,configurable:!0,get(){const n=t.get(this);return n&&n[e]||null},set(n){const a=e.replace("on",""),r=this[e];t.has(this)||t.set(this,{}),r&&this.removeEventListener(a,r),this.addEventListener(a,n),t.get(this)[e]=n}})}),y},Element:e=>{const t=(t,n)=>function(){const[a,r]=n(arguments),o=Array.from(arguments).map(t=>e.toNativeAny(t)),i=e.toNativeObject(this),l=i.nodeName;if(!e.sanitizer.isValidAttribute(l,a,r)||0===a.indexOf(e.prefix)||0===r.indexOf(e.prefix))throw new e.SandboxSecurityError(`Forbidden: attribute [${a}=${JSON.stringify(r)}]`);const c=i[t](...o);return c},n=t("setAttribute",e=>e),a=t("setAttributeNS",e=>[e[1],e[2]]),r=t("setAttributeNode",e=>[e[0].name,e[0].value]),o=t("setAttributeNodeNS",e=>[e[0].name,e[0].value]),i=t("removeAttribute",e=>[e[0],""]),l=t("removeAttributeNS",e=>[e[1],""]),c=t("toggleAttribute",e=>[e[0],""]);return{set innerHTML(t){const n=e.toNativeObject(this),a=e.sanitizer.sanitize(t);for(;n.firstChild;)n.removeChild(n.firstChild);"template"===n.nodeName.toLowerCase()?n.content.appendChild(a):n.appendChild(a)},get innerHTML(){return e.toNativeObject(this).innerHTML},set outerHTML(t){const n=e.toNativeObject(this),a=e.sanitizer.sanitize(t);n.parentNode.replaceChild(a,n)},get outerHTML(){return e.toNativeObject(this).outerHTML},insertAdjacentHTML(t,n){const a=e.toNativeObject(this),r=e.sanitizer.sanitize(n);return a.insertAdjacentElement(t,r)},removeAttribute:i,removeAttributeNS:l,setAttribute:n,setAttributeNS:a,setAttributeNode:r,setAttributeNodeNS:o,toggleAttribute:c}},Event:e=>({get composed(){return!1},composedPath(){const t=e.global,n=e.documentView,a=e.toNativeObject(this).composedPath();return a.filter(t=>t===e.parent||t instanceof e.parent.Node&&n.contains(t)).map(n=>n===e.parent?t:e.toVirtualObject(n))}}),HTMLElement:e=>({constructor:function(){if(e.currentNativeObject)e.bindObject(this,e.currentNativeObject);else throw TypeError(`Illegal constructor`)}}),HTMLScriptElement:e=>{const t=e.scriptType,n=(t,n,a)=>{if(!e.sanitizer.isValidAttribute(t.nodeName,n,a))throw new e.SandboxSecurityError(`Forbidden: attribute [${n}=${JSON.stringify(a)}]`)};return{constructor:function(){if(e.currentNativeObject)e.currentNativeObject.setAttribute("type",t);else throw TypeError(`Illegal constructor`)},get src(){const t=e.toNativeObject(this),n=t.getAttribute("src");return null===n?"":new e.top.URL(n,this.baseURI).href},set src(t){if(e.cspSandboxCheck("allow-import-scripts")){const a=e.toNativeObject(this);n(a,"src",t),a.setAttribute("src",t)}},get type(){const t=e.toNativeObject(this),n=t.getAttribute("type");return null===n?"":n},set type(t){const a=e.toNativeObject(this);n(a,"type",t),a.setAttribute("type",t)},[e.Symbol.connectedCallback](){const n=e.toNativeObject(this);if(n.getAttribute("type")!==t)return;const a=e.classRegistry.get("Event");e.script({src:this.src,textContent:this.textContent,currentScript:this}).then(()=>{this.dispatchEvent(new a("load"))},()=>{this.dispatchEvent(new a("error"))})}}},Node:e=>({get ownerDocument(){const t=e.global.document;return t===this?null:t},get nodeName(){const t=e.global.document,n=t===this?e.parent.document:e.toNativeObject(this);return n.nodeName},get nodeType(){const t=e.global.document,n=t===this?e.parent.document:e.toNativeObject(this);return n.nodeType}}),ShadowRoot:e=>({set innerHTML(t){const n=e.toNativeObject(this),a=e.sanitizer.sanitize(t);for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(a)},get innerHTML(){return e.toNativeObject(this).innerHTML}}),Storage:(e,t)=>{const n=`${e.prefix}${e.namespace}.`,a=e=>Object.keys(e).filter(e=>0===e.indexOf(n));return{constructor:function(){if(e.currentNativeObject)return t.inherits(this,new Proxy(e.currentNativeObject,{get(t,n){const a=e.toVirtualObject(t);return"string"==typeof n?a.getItem(n):void 0},set(t,n,a){const r=e.toVirtualObject(t);return"string"==typeof n&&(r.setItem(n,a),!0)},deleteProperty(t,n){const a=e.toVirtualObject(t);return"string"==typeof n&&(a.removeItem(n),!0)}}));throw TypeError(`Illegal constructor`)},get length(){const t=e.toNativeObject(this);return a(t).length},key(t){const n=e.toNativeObject(this);return n.getItem(a(n)[t])},getItem(t){return e.toNativeObject(this).getItem(`${n}${t}`)},setItem(t,a){return e.toNativeObject(this).setItem(`${n}${t}`,a)},removeItem(t){return e.toNativeObject(this).removeItem(`${n}${t}`)},clear(){const t=e.toNativeObject(this);a(this).forEach(e=>t.removeItem(e))}}}},ct=e=>{const t={};return Object.entries(lt).forEach(([n,a])=>{t[n]=e.run(a)}),e.interfaceGenerator(t,rt.allow)},st=e=>e.run(ot),dt=e=>{e.permissions=at,e.compartment=e.compartment||Ze();const t=e.compartment.global,n=e.parent,a=e.windowView,r=e.documentView,o=tt(e,it);["Object","Array","Promise"].forEach(e=>{o.classRegistry.set(e,o.createVirtualClass(e,null,null,rt.allow.includes(e)))}),Object.assign(t,ct(o)),Object.assign(t,st(o)),o.bindObject(t,a),Reflect.setPrototypeOf(t,Object.create(o.classRegistry.get("Window").prototype)),["window","document","location"].forEach(e=>{Reflect.defineProperty(t,e,{writable:!1,configurable:!1,enumerable:!0})}),n.addEventListener("hashchange",e=>{const n=o.toVirtualObject(new e.constructor(e.type,{newUrl:e.newURL,oldURL:e.oldURL}));t.dispatchEvent(n)});const i=e=>{const n=o.toVirtualObject(e);n[o.Symbol.connectedCallback]?n[o.Symbol.connectedCallback]():t.customElements.get(n.localName)&&n.connectedCallback&&n.connectedCallback(),e.childNodes.forEach(i)},l=e=>{const n=o.toVirtualObject(e);n[o.Symbol.disconnectedCallback]?n[o.Symbol.disconnectedCallback]():t.customElements.get(n.localName)&&n.disconnectedCallback&&n.disconnectedCallback(),e.childNodes.forEach(l)},c=new o.parent.MutationObserver(e=>{e.forEach(e=>{if("childList"===e.type){const{addedNodes:t,removedNodes:n}=e;try{t.forEach(i),n.forEach(l)}catch(e){o.console.error(e)}}})});return c.observe(r,{childList:!0,subtree:!0}),x(o),{global:t,evaluate(){return o.compartment.evaluate(...arguments)},bootstrap({src:e,srcdoc:n}){o.script({src:e,textContent:n}).then(()=>{t.dispatchEvent(new t.Event("load"))},()=>{t.dispatchEvent(new t.Event("error"))})},unload(){t.close()}}};let ut,mt=0;const pt=Symbol("virtual-browser"),{document:bt,URL:ft,HTMLElement:Et}=window;class St extends Et{constructor(){if(super(),this.debug=(()=>{}).toString().includes("/**/"),this.attachShadow({mode:"open"}),!ut){const e=bt.createElement("style"),t="contain"in this.style?"contain: layout":"transform: scale(1)";e.textContent=`${this.localName} { ${t} }`,bt.head.appendChild(e),ut=!0}mt++}get[Symbol.toStringTag](){return"HTMLWebSandboxElement"}get name(){return this.getAttribute("name")}set name(e){this.setAttribute("name",e)}get src(){const e=this.getAttribute("src");return null===e?"":new ft(e,this.baseURI).href}set src(e){this.setAttribute("src",e)}get srcdoc(){return this.getAttribute("srcdoc")}set srcdoc(e){this.setAttribute("srcdoc",e)}get csp(){return this.getAttribute("csp")}set csp(e){this.setAttribute("csp",e)}get contentWindow(){return this[pt].global}get contentDocument(){return this[pt].global.document}evaluate(){return this[pt].evaluate(...arguments)}connectedCallback(){const e=this.csp||"";this[pt]=dt({csp:e,windowView:this,documentView:this.shadowRoot,title:this.name,namespace:this.name||`sandbox${mt}`,debug:this.debug,top:window,parent:window}),this[pt].bootstrap({src:this.src,textContent:this.srcdoc})}disconnectedCallback(){this[pt].unload()}}Reflect.defineProperty(St,"name",{value:"HTMLWebSandboxElement"}),window.HTMLWebSandboxElement=St,window.WebSandbox=L,window.customElements.define("web-sandbox",St),e.HTMLWebSandboxElement=St,e.WebSandbox=L,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=web-sandbox.umd.js.map
